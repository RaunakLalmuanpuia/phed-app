import{Q as ye,a as K}from"./QBreadcrumbs-4WfYUnMz.js";import{Q as L}from"./QSelect-Bkb1GhB6.js";import{H as xe,ae as we,M as ke,af as qe,c as X,n as O,I as W,r as s,x as Z,d as U,o as S,w as n,e as l,i as a,g as j,y as A,z as _,u,p as Ve,q as V,h as y,t as c,Q as Y,D as ee,a0 as te,$ as ae,N as ne}from"./app-DXEdkIVl.js";import{Q as R}from"./QTd-CbO24mQ4.js";import{Q as he}from"./QTable-Bw5MSF_H.js";import{Q as Ce}from"./QLayout-DZdTd7jz.js";import{_ as Qe,C as le}from"./BackendLayout-CWz6uiC5.js";import{u as Re}from"./use-quasar-D24dwCRU.js";import{u as Be}from"./useUtils-CSZEUq-7.js";import"./QMarkupTable-DpKjKpa8.js";import"./use-fullscreen-COzekHwx.js";import"./touch-BCTSgPn8.js";import"./QSlideTransition-6PgW9VC0.js";import"./date-CBPAq6uw.js";const De=xe({name:"QBanner",props:{...we,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(f,{slots:h}){const{proxy:{$q:p}}=ke(),$=qe(f,p),B=X(()=>"q-banner row items-center"+(f.dense===!0?" q-banner--dense":"")+($.value===!0?" q-banner--dark q-dark":"")+(f.rounded===!0?" rounded-borders":"")),x=X(()=>`q-banner__actions row items-center justify-end col-${f.inlineActions===!0?"auto":"all"}`);return()=>{const b=[O("div",{class:"q-banner__avatar col-auto row items-center self-start"},W(h.avatar)),O("div",{class:"q-banner__content col text-body2"},W(h.default))],i=W(h.action);return i!==void 0&&b.push(O("div",{class:x.value},i)),O("div",{class:B.value+(f.inlineActions===!1&&i!==void 0?" q-banner--top-padding":""),role:"alert"},b)}}}),Ue={class:"flex items-center justify-between q-pa-md bg-white"},Se={class:"q-pa-md"},Ee={class:"row q-col-gutter-md"},Ie={class:"row q-gutter-sm col-12 col-sm justify-end"},Ne={class:"row q-mb-sm items-center"},Pe={class:"col-8 text-body1"},Te={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},je={class:"row q-mb-sm items-center"},Ae={class:"col-8 text-body1"},Ye={class:"row q-mb-sm items-center"},$e={class:"col-8 text-body1"},Ge={class:"row q-mb-sm items-center"},Me={class:"col-8 text-body1"},Fe={class:"row q-mb-sm items-center"},ze={class:"col-8 text-body1"},oe=2020,He=2035,it=Object.assign({layout:Qe},{__name:"Detail",props:["office","canGenerateRemuneration","canCreateRemuneration","canEditRemuneration","canBulkUpdateRemuneration"],setup(f){const{formatDate:h}=Be(),p=s({offices:[],incrementYear:""}),$=Array.from({length:He-oe+1},(o,e)=>oe+e),B=s(""),x=s([]),b=s(!1),i=Re(),E=s([]),G=s(!1),d=Z({employee_ids:[],next_increment_date:""}),C=s(!1),D=s(!1),M=s(!1),v=s(null);function re(){if(!p.value.offices||p.value.offices.length===0){i.notify({type:"negative",message:"Please select an office"});return}if(!p.value.incrementYear){i.notify({type:"negative",message:"Please enter the increment year"});return}M.value=!0,E.value=[],setTimeout(()=>{v.value&&v.value.requestServerInteraction()})}function se(){Q.value.page=1,v.value&&v.value.requestServerInteraction()}function F(){E.value=[],M.value=!1}function ie(o){(!o||o.length===0)&&F()}const m=Z({remuneration:"",next_increment_date:"",pay_matrix:""}),Q=s({sortBy:"next_increment_date",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),ue=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"remuneration",label:"Remuneration",field:"remuneration_detail.remuneration",align:"right"},{name:"round_total",label:"Total Monthly Remuneration",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.round_total",align:"right"},{name:"next_increment_date",label:"Date of Next Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.next_increment_date",align:"left"},{name:"next_increment_amount",label:"Remuneration After Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.total",align:"left"},{name:"actions",label:"Actions",align:"center"}],z=s(null),w=s(null),de=o=>{w.value=o,o.remuneration_detail?(m.remuneration=o.remuneration_detail.total,m.next_increment_date=o.remuneration_detail.next_increment_date,m.pay_matrix=o.remuneration_detail.pay_matrix):m.reset(),z.value=o.id,D.value=!0,C.value=!1};function me(){d.reset(),d.employee_ids=x.value.map(o=>o.id),b.value=!0}const ce=()=>{C.value=!0},fe=()=>{C.value=!1,D.value=!1,m.reset()},pe=()=>{b.value=!1,d.reset()};function ve(o){const{page:e,rowsPerPage:t,sortBy:r,descending:I}=o.pagination;G.value=!0,axios.get(route("remuneration.json-detail"),{params:{filter:{...p.value},page:e,rowsPerPage:t,search:B.value,sortBy:r,descending:I}}).then(g=>{const{list:k}=g.data,{data:q,per_page:N,current_page:P,total:T}=k;E.value=q,Q.value.page=P,Q.value.rowsNumber=T,Q.value.rowsPerPage=N}).catch(g=>{var k,q;i.notify({type:"negative",message:(q=(k=g==null?void 0:g.response)==null?void 0:k.data)==null?void 0:q.message})}).finally(()=>G.value=!1)}const be=()=>{z.value&&m.put(route("remuneration.update",z.value),{onSuccess:()=>{D.value=!1,m.reset(),v.value&&v.value.requestServerInteraction(),i.notify({type:"positive",message:"Remuneration updated successfully."})},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})};function ge(){if(!d.next_increment_date){i.notify({type:"negative",message:"Please select a new increment date"});return}d.post(route("remuneration.bulk-update"),{preserveScroll:!0,onSuccess:()=>{i.notify({type:"positive",message:"Increment updated successfully"}),b.value=!1,x.value=[],d.reset(),v.value&&v.value.requestServerInteraction()},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})}const _e=()=>{window.history.back()};return(o,e)=>(S(),U(Ce,{class:"container",padding:""},{default:n(()=>[l("div",Ue,[l("div",null,[e[11]||(e[11]=l("div",{class:"stitle"},"Remuneration Details",-1)),a(ye,{class:"text-dark"},{default:n(()=>[a(K,{onClick:e[0]||(e[0]=t=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),a(K,{class:"cursor-pointer",label:"Go Back",onClick:_e})]),_:1})])]),e[22]||(e[22]=l("br",null,null,-1)),a(A,{flat:""},{default:n(()=>[a(_,null,{default:n(()=>[l("div",Se,[a(A,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:n(()=>[a(_,null,{default:n(()=>[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),l("div",Ee,[a(L,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:p.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>p.value.offices=t),ie],options:f.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:F},null,8,["modelValue","options"]),a(L,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Increment Year",modelValue:p.value.incrementYear,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value.incrementYear=t),options:u($),"emit-value":"","map-options":"",onClear:F},null,8,["modelValue","options"])])]),_:1,__:[12]}),a(Ve),a(_,{class:"row items-center justify-between q-gutter-md"},{default:n(()=>[l("div",Ie,[f.canGenerateRemuneration?(S(),U(V,{key:0,label:"Get Employee",color:"primary",onClick:re})):j("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[23]||(e[23]=l("br",null,null,-1)),M.value?(S(),U(he,{key:0,ref_key:"empTable",ref:v,title:"Employees Remuneration",rows:E.value,columns:ue,"row-key":"id",loading:G.value,pagination:Q.value,"onUpdate:pagination":e[4]||(e[4]=t=>Q.value=t),"rows-per-page-options":[5,10,20,50],onRequest:ve,selection:"multiple",selected:x.value,"onUpdate:selected":e[5]||(e[5]=t=>x.value=t)},{"top-right":n(()=>[x.value.length>0&&f.canBulkUpdateRemuneration?(S(),U(V,{key:0,class:"q-mr-sm",icon:"upload",label:"Update",color:"primary",onClick:me})):j("",!0),a(Y,{dense:"",outlined:"",debounce:"800",modelValue:B.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>B.value=t),se],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:n(()=>[a(ee,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":n(t=>[a(R,{props:t},{default:n(()=>{var r;return[y(c((r=t.row.office)==null?void 0:r.name),1)]}),_:2},1032,["props"])]),"body-cell-remuneration":n(t=>[a(R,{props:t},{default:n(()=>{var r;return[y(" ₹"+c((r=t.row.remuneration_detail)==null?void 0:r.remuneration),1)]}),_:2},1032,["props"])]),"body-cell-round_total":n(t=>[a(R,{props:t},{default:n(()=>{var r;return[y(" ₹"+c((r=t.row.remuneration_detail)==null?void 0:r.round_total),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_date":n(t=>[a(R,{props:t},{default:n(()=>{var r;return[y(c(u(h)((r=t.row.remuneration_detail)==null?void 0:r.next_increment_date)),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_amount":n(t=>[a(R,{props:t},{default:n(()=>{var r;return[y(" ₹"+c((r=t.row.remuneration_detail)==null?void 0:r.total),1)]}),_:2},1032,["props"])]),"body-cell-actions":n(t=>[a(R,{props:t},{default:n(()=>[f.canEditRemuneration?(S(),U(V,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:r=>de(t.row),"aria-label":"Edit"},null,8,["onClick"])):j("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):j("",!0),a(te,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=t=>D.value=t)},{default:n(()=>[a(A,{style:{"min-width":"400px"}},{default:n(()=>[a(_,null,{default:n(()=>e[13]||(e[13]=[l("div",{class:"text-h6"},"Edit Remuneration",-1)])),_:1,__:[13]}),a(_,{class:"q-gutter-md"},{default:n(()=>{var t,r,I,g,k,q,N,P,T,J;return[l("div",Ne,[e[14]||(e[14]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),l("div",Pe,c((t=w.value)==null?void 0:t.name),1)]),l("div",Te,[e[15]||(e[15]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),l("div",Oe,c((r=w.value)==null?void 0:r.designation),1)]),l("div",je,[e[16]||(e[16]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Office",-1)),l("div",Ae,c((g=(I=w.value)==null?void 0:I.office)==null?void 0:g.name),1)]),l("div",Ye,[e[17]||(e[17]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Current Remuneration (Total)",-1)),l("div",$e,"Rs "+c(((q=(k=w.value)==null?void 0:k.remuneration_detail)==null?void 0:q.total)||0),1)]),l("div",Ge,[e[18]||(e[18]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Next Increment",-1)),l("div",Me,c(u(h)((P=(N=w.value)==null?void 0:N.remuneration_detail)==null?void 0:P.next_increment_date)||0),1)]),l("div",Fe,[e[19]||(e[19]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Pay Matrix",-1)),l("div",ze,c((J=(T=w.value)==null?void 0:T.remuneration_detail)==null?void 0:J.pay_matrix),1)]),a(Y,{label:"Remuneration",type:"number",modelValue:u(m).remuneration,"onUpdate:modelValue":e[6]||(e[6]=H=>u(m).remuneration=H),outlined:"",dense:"",readonly:!C.value},{append:n(()=>[a(ee,{name:"edit",class:"cursor-pointer",onClick:ce})]),_:1},8,["modelValue","readonly"]),a(Y,{label:"Next Increment Date",type:"date",modelValue:u(m).next_increment_date,"onUpdate:modelValue":e[7]||(e[7]=H=>u(m).next_increment_date=H),outlined:"",dense:"",readonly:!C.value},null,8,["modelValue","readonly"])]}),_:1}),a(ae,{align:"right"},{default:n(()=>[ne(a(V,{flat:"",label:"Cancel",onClick:fe},null,512),[[le]]),a(V,{color:"primary",label:"Update",disable:!C.value,onClick:be},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(te,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=t=>b.value=t)},{default:n(()=>[a(A,{style:{"min-width":"300px"}},{default:n(()=>[a(_,null,{default:n(()=>e[20]||(e[20]=[l("div",{class:"text-h6"},"Update Remuneration",-1)])),_:1,__:[20]}),a(_,null,{default:n(()=>[a(De,{class:"bg-grey-2 text-body2 q-pa-sm rounded-borders"},{default:n(()=>e[21]||(e[21]=[y(" Note: When updating the increment date, each selected employee’s "),l("strong",null,"remuneration",-1),y(" will be set to their "),l("strong",null,"next increment amount",-1),y(", and the new increment date will be applied based on this updated remuneration. ")])),_:1,__:[21]})]),_:1}),a(_,null,{default:n(()=>[a(Y,{type:"date",modelValue:u(d).next_increment_date,"onUpdate:modelValue":e[9]||(e[9]=t=>u(d).next_increment_date=t),outlined:"",label:"New Increment Date",dense:"",error:!!u(d).errors.next_increment_date,"error-message":u(d).errors.next_increment_date},null,8,["modelValue","error","error-message"])]),_:1}),a(ae,{align:"right"},{default:n(()=>[ne(a(V,{flat:"",label:"Cancel",onClick:pe},null,512),[[le]]),a(V,{color:"primary",label:"Update",loading:u(d).processing,onClick:ge},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[22,23]}))}});export{it as default};
