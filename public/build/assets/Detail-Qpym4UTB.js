import{Q as ye,a as K}from"./QBreadcrumbs-BX8tW6QA.js";import{Q as L}from"./QSelect-CAMfxAU9.js";import{H as we,ae as xe,M as ke,af as qe,c as X,n as P,I as H,r,x as Z,d as T,o as O,w as n,e as l,i as t,g as W,y as j,z as _,u,p as Ve,q as V,h as y,t as m,Q as A,D as ee,a0 as te,$ as ae,N as ne}from"./app-IoKy4pgD.js";import{Q as D}from"./QTd-D9cD7ei5.js";import{Q as he}from"./QTable-CLpXqmH7.js";import{Q as Ce}from"./QLayout-DBtkQzBO.js";import{_ as Qe,C as le}from"./BackendLayout-CRsHSdQW.js";import{u as De}from"./use-quasar-BWy-66A1.js";import{u as Be}from"./useUtils-BKFI-RNX.js";import"./use-fullscreen-DPkM7kda.js";import"./touch-DA5BhWY1.js";import"./date-BOmjOytd.js";const Se=we({name:"QBanner",props:{...xe,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(v,{slots:h}){const{proxy:{$q:c}}=ke(),Y=qe(v,c),B=X(()=>"q-banner row items-center"+(v.dense===!0?" q-banner--dense":"")+(Y.value===!0?" q-banner--dark q-dark":"")+(v.rounded===!0?" rounded-borders":"")),w=X(()=>`q-banner__actions row items-center justify-end col-${v.inlineActions===!0?"auto":"all"}`);return()=>{const b=[P("div",{class:"q-banner__avatar col-auto row items-center self-start"},H(h.avatar)),P("div",{class:"q-banner__content col text-body2"},H(h.default))],i=H(h.action);return i!==void 0&&b.push(P("div",{class:w.value},i)),P("div",{class:B.value+(v.inlineActions===!1&&i!==void 0?" q-banner--top-padding":""),role:"alert"},b)}}}),Re={class:"flex items-center justify-between q-pa-md bg-white"},Ue={class:"q-pa-md"},Ie={class:"row q-col-gutter-md"},Ee={class:"row q-gutter-sm col-12 col-sm justify-end"},Ne={class:"row q-mb-sm items-center"},Pe={class:"col-8 text-body1"},Te={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},je={class:"row q-mb-sm items-center"},Ae={class:"col-8 text-body1"},Ye={class:"row q-mb-sm items-center"},$e={class:"col-8 text-body1"},Ge={class:"row q-mb-sm items-center"},Me={class:"col-8 text-body1"},Fe={class:"row q-mb-sm items-center"},ze={class:"col-8 text-body1"},oe=2020,He=2035,st=Object.assign({layout:Qe},{__name:"Detail",props:["office","canGenerateRemuneration"],setup(v){const{formatDate:h}=Be(),c=r({offices:[],incrementYear:""}),Y=Array.from({length:He-oe+1},(o,e)=>oe+e),B=r(""),w=r([]),b=r(!1),i=De(),R=r([]),$=r(!1),d=Z({employee_ids:[],next_increment_date:""}),C=r(!1),S=r(!1),G=r(!1),p=r(null);function se(){if(!c.value.offices||c.value.offices.length===0){i.notify({type:"negative",message:"Please select an office"});return}if(!c.value.incrementYear){i.notify({type:"negative",message:"Please enter the increment year"});return}G.value=!0,R.value=[],setTimeout(()=>{p.value&&p.value.requestServerInteraction()})}function re(){Q.value.page=1,p.value&&p.value.requestServerInteraction()}function M(){R.value=[],G.value=!1}function ie(o){(!o||o.length===0)&&M()}const f=Z({remuneration:"",next_increment_date:""}),Q=r({sortBy:"next_increment_date",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),ue=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"remuneration",label:"Remuneration",field:"remuneration_detail.remuneration",align:"right"},{name:"round_total",label:"Total Monthly Remuneration",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.round_total",align:"right"},{name:"next_increment_date",label:"Date of Next Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.next_increment_date",align:"left"},{name:"next_increment_amount",label:"Remuneration After Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.total",align:"left"},{name:"actions",label:"Actions",align:"center"}],F=r(null),x=r(null),de=o=>{x.value=o,o.remuneration_detail?(f.remuneration=o.remuneration_detail.total,f.next_increment_date=o.remuneration_detail.next_increment_date):f.reset(),F.value=o.id,S.value=!0,C.value=!1};function me(){d.reset(),d.employee_ids=w.value.map(o=>o.id),b.value=!0}const ce=()=>{C.value=!0},fe=()=>{C.value=!1,S.value=!1,f.reset()},pe=()=>{b.value=!1,d.reset()};function ve(o){const{page:e,rowsPerPage:a,sortBy:s,descending:U}=o.pagination;$.value=!0,axios.get(route("remuneration.json-detail"),{params:{filter:{...c.value},page:e,rowsPerPage:a,search:B.value,sortBy:s,descending:U}}).then(g=>{const{list:k}=g.data,{data:q,per_page:I,current_page:E,total:N}=k;R.value=q,Q.value.page=E,Q.value.rowsNumber=N,Q.value.rowsPerPage=I}).catch(g=>{var k,q;i.notify({type:"negative",message:(q=(k=g==null?void 0:g.response)==null?void 0:k.data)==null?void 0:q.message})}).finally(()=>$.value=!1)}const be=()=>{F.value&&f.put(route("remuneration.update",F.value),{onSuccess:()=>{S.value=!1,f.reset(),p.value&&p.value.requestServerInteraction(),i.notify({type:"positive",message:"Remuneration updated successfully."})},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})};function ge(){if(!d.next_increment_date){i.notify({type:"negative",message:"Please select a new increment date"});return}d.post(route("remuneration.bulk-update"),{preserveScroll:!0,onSuccess:()=>{i.notify({type:"positive",message:"Increment updated successfully"}),b.value=!1,w.value=[],d.reset(),p.value&&p.value.requestServerInteraction()},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})}const _e=()=>{window.history.back()};return(o,e)=>(O(),T(Ce,{class:"container",padding:""},{default:n(()=>[l("div",Re,[l("div",null,[e[11]||(e[11]=l("div",{class:"stitle"},"Remuneration Details",-1)),t(ye,{class:"text-dark"},{default:n(()=>[t(K,{onClick:e[0]||(e[0]=a=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),t(K,{class:"cursor-pointer",label:"Go Back",onClick:_e})]),_:1})])]),e[22]||(e[22]=l("br",null,null,-1)),t(j,{flat:""},{default:n(()=>[t(_,null,{default:n(()=>[l("div",Ue,[t(j,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:n(()=>[t(_,null,{default:n(()=>[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),l("div",Ie,[t(L,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:c.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=a=>c.value.offices=a),ie],options:v.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:M},null,8,["modelValue","options"]),t(L,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Increment Year",modelValue:c.value.incrementYear,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value.incrementYear=a),options:u(Y),"emit-value":"","map-options":"",onClear:M},null,8,["modelValue","options"])])]),_:1,__:[12]}),t(Ve),t(_,{class:"row items-center justify-between q-gutter-md"},{default:n(()=>[l("div",Ee,[v.canGenerateRemuneration?(O(),T(V,{key:0,label:"Get Employee",color:"primary",onClick:se})):W("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[23]||(e[23]=l("br",null,null,-1)),G.value?(O(),T(he,{key:0,ref_key:"empTable",ref:p,title:"Employees Remuneration",rows:R.value,columns:ue,"row-key":"id",loading:$.value,pagination:Q.value,"onUpdate:pagination":e[4]||(e[4]=a=>Q.value=a),"rows-per-page-options":[5,10,20,50],onRequest:ve,selection:"multiple",selected:w.value,"onUpdate:selected":e[5]||(e[5]=a=>w.value=a)},{"top-right":n(()=>[w.value.length>0?(O(),T(V,{key:0,class:"q-mr-sm",icon:"upload",label:"Update",color:"primary",onClick:me})):W("",!0),t(A,{dense:"",outlined:"",debounce:"800",modelValue:B.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>B.value=a),re],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:n(()=>[t(ee,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(m((s=a.row.office)==null?void 0:s.name),1)]}),_:2},1032,["props"])]),"body-cell-remuneration":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+m((s=a.row.remuneration_detail)==null?void 0:s.remuneration),1)]}),_:2},1032,["props"])]),"body-cell-round_total":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+m((s=a.row.remuneration_detail)==null?void 0:s.round_total),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_date":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(m(u(h)((s=a.row.remuneration_detail)==null?void 0:s.next_increment_date)),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_amount":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+m((s=a.row.remuneration_detail)==null?void 0:s.total),1)]}),_:2},1032,["props"])]),"body-cell-actions":n(a=>[t(D,{props:a},{default:n(()=>[t(V,{dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:s=>de(a.row),"aria-label":"Edit"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):W("",!0),t(te,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=a=>S.value=a)},{default:n(()=>[t(j,{style:{"min-width":"400px"}},{default:n(()=>[t(_,null,{default:n(()=>e[13]||(e[13]=[l("div",{class:"text-h6"},"Edit Remuneration",-1)])),_:1,__:[13]}),t(_,{class:"q-gutter-md"},{default:n(()=>{var a,s,U,g,k,q,I,E,N,J;return[l("div",Ne,[e[14]||(e[14]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),l("div",Pe,m((a=x.value)==null?void 0:a.name),1)]),l("div",Te,[e[15]||(e[15]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),l("div",Oe,m((s=x.value)==null?void 0:s.designation),1)]),l("div",je,[e[16]||(e[16]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Office",-1)),l("div",Ae,m((g=(U=x.value)==null?void 0:U.office)==null?void 0:g.name),1)]),l("div",Ye,[e[17]||(e[17]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Current Remuneration (Total)",-1)),l("div",$e,"Rs "+m(((q=(k=x.value)==null?void 0:k.remuneration_detail)==null?void 0:q.total)||0),1)]),l("div",Ge,[e[18]||(e[18]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Next Increment",-1)),l("div",Me,m(u(h)((E=(I=x.value)==null?void 0:I.remuneration_detail)==null?void 0:E.next_increment_date)||0),1)]),l("div",Fe,[e[19]||(e[19]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Pay Matrix",-1)),l("div",ze,m((J=(N=x.value)==null?void 0:N.remuneration_detail)==null?void 0:J.pay_matrix),1)]),t(A,{label:"Remuneration",type:"number",modelValue:u(f).remuneration,"onUpdate:modelValue":e[6]||(e[6]=z=>u(f).remuneration=z),outlined:"",dense:"",readonly:!C.value},{append:n(()=>[t(ee,{name:"edit",class:"cursor-pointer",onClick:ce})]),_:1},8,["modelValue","readonly"]),t(A,{label:"Next Increment Date",type:"date",modelValue:u(f).next_increment_date,"onUpdate:modelValue":e[7]||(e[7]=z=>u(f).next_increment_date=z),outlined:"",dense:"",readonly:!C.value},null,8,["modelValue","readonly"])]}),_:1}),t(ae,{align:"right"},{default:n(()=>[ne(t(V,{flat:"",label:"Cancel",onClick:fe},null,512),[[le]]),t(V,{color:"primary",label:"Update",disable:!C.value,onClick:be},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a)},{default:n(()=>[t(j,{style:{"min-width":"300px"}},{default:n(()=>[t(_,null,{default:n(()=>e[20]||(e[20]=[l("div",{class:"text-h6"},"Update Remuneration",-1)])),_:1,__:[20]}),t(_,null,{default:n(()=>[t(Se,{class:"bg-grey-2 text-body2 q-pa-sm rounded-borders"},{default:n(()=>e[21]||(e[21]=[y(" Note: When updating the increment date, each selected employee’s "),l("strong",null,"remuneration",-1),y(" will be set to their "),l("strong",null,"next increment amount",-1),y(", and the new increment date will be applied based on this updated remuneration. ")])),_:1,__:[21]})]),_:1}),t(_,null,{default:n(()=>[t(A,{type:"date",modelValue:u(d).next_increment_date,"onUpdate:modelValue":e[9]||(e[9]=a=>u(d).next_increment_date=a),outlined:"",label:"New Increment Date",dense:"",error:!!u(d).errors.next_increment_date,"error-message":u(d).errors.next_increment_date},null,8,["modelValue","error","error-message"])]),_:1}),t(ae,{align:"right"},{default:n(()=>[ne(t(V,{flat:"",label:"Cancel",onClick:pe},null,512),[[le]]),t(V,{color:"primary",label:"Update",loading:u(d).processing,onClick:ge},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[22,23]}))}});export{st as default};
