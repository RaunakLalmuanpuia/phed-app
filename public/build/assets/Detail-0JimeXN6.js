import{Q as ge,a as W}from"./QBreadcrumbs-P1G1ozD1.js";import{Q as J}from"./QSelect-Jujm_534.js";import{H as _e,ae as ye,M as xe,af as we,D as K,k as P,I as z,r,x as L,c as T,o as O,w as n,b as l,f as t,e as H,p as j,q as _,u,l as ke,m as q,B as y,t as f,Q as A,z as X,a0 as Z,$ as ee,N as te}from"./app-txZQMSBX.js";import{Q as D}from"./QTd-A9CnOsmp.js";import{Q as qe}from"./QTable-BKXey8ST.js";import{Q as Ve}from"./QLayout-C71oroUo.js";import{_ as Ce,C as ae}from"./BackendLayout-Brp6cZYj.js";import{u as Qe}from"./use-quasar-BW0lFDFD.js";import{u as Be}from"./useUtils-BYho3IXp.js";import"./use-fullscreen-CXJ6O_rU.js";import"./touch-BFGPAXUe.js";import"./date-CAtG4bnC.js";const De=_e({name:"QBanner",props:{...ye,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(v,{slots:V}){const{proxy:{$q:m}}=xe(),Y=we(v,m),h=K(()=>"q-banner row items-center"+(v.dense===!0?" q-banner--dense":"")+(Y.value===!0?" q-banner--dark q-dark":"")+(v.rounded===!0?" rounded-borders":"")),x=K(()=>`q-banner__actions row items-center justify-end col-${v.inlineActions===!0?"auto":"all"}`);return()=>{const b=[P("div",{class:"q-banner__avatar col-auto row items-center self-start"},z(V.avatar)),P("div",{class:"q-banner__content col text-body2"},z(V.default))],i=z(V.action);return i!==void 0&&b.push(P("div",{class:x.value},i)),P("div",{class:h.value+(v.inlineActions===!1&&i!==void 0?" q-banner--top-padding":""),role:"alert"},b)}}}),he={class:"flex items-center justify-between q-pa-md bg-white"},Ue={class:"q-pa-md"},Ie={class:"row q-col-gutter-md"},Ne={class:"row q-gutter-sm col-12 col-sm justify-end"},Re={class:"row q-mb-sm items-center"},Se={class:"col-8 text-body1"},Ee={class:"row q-mb-sm items-center"},Pe={class:"col-8 text-body1"},Te={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},je={class:"row q-mb-sm items-center"},Ae={class:"col-8 text-body1"},Ye={class:"row q-mb-sm items-center"},$e={class:"col-8 text-body1"},ne=2020,Ge=2035,at=Object.assign({layout:Ce},{__name:"Detail",props:["office","canGenerateRemuneration"],setup(v){const{formatDate:V}=Be(),m=r({offices:[],incrementYear:""}),Y=Array.from({length:Ge-ne+1},(o,e)=>ne+e),h=r(""),x=r([]),b=r(!1),i=Qe(),N=r([]),$=r(!1),d=L({employee_ids:[],next_increment_date:""}),C=r(!1),U=r(!1),G=r(!1),p=r(null);function le(){if(!m.value.offices||m.value.offices.length===0){i.notify({type:"negative",message:"Please select an office"});return}if(!m.value.incrementYear){i.notify({type:"negative",message:"Please enter the increment year"});return}G.value=!0,N.value=[],setTimeout(()=>{p.value&&p.value.requestServerInteraction()})}function oe(){Q.value.page=1,p.value&&p.value.requestServerInteraction()}function F(){N.value=[],G.value=!1}function se(o){(!o||o.length===0)&&F()}const c=L({remuneration:"",next_increment_date:""}),Q=r({sortBy:"next_increment_date",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),re=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"remuneration",label:"Remuneration",field:"remuneration_detail.remuneration",align:"right"},{name:"round_total",label:"Total",field:"remuneration_detail.round_total",align:"right"},{name:"next_increment_date",label:"Next Increment",field:"remuneration_detail.next_increment_date",align:"left"},{name:"next_increment_amount",label:"Next Increment Amount",field:"remuneration_detail.total",align:"left"},{name:"actions",label:"Actions",align:"center"}],M=r(null),B=r(null),ie=o=>{B.value=o,o.remuneration_detail?(c.remuneration=o.remuneration_detail.total,c.next_increment_date=o.remuneration_detail.next_increment_date):c.reset(),M.value=o.id,U.value=!0,C.value=!1};function ue(){d.reset(),d.employee_ids=x.value.map(o=>o.id),b.value=!0}const de=()=>{C.value=!0},me=()=>{C.value=!1,U.value=!1,c.reset()},ce=()=>{b.value=!1,d.reset()};function fe(o){const{page:e,rowsPerPage:a,sortBy:s,descending:R}=o.pagination;$.value=!0,axios.get(route("remuneration.json-detail"),{params:{filter:{...m.value},page:e,rowsPerPage:a,search:h.value,sortBy:s,descending:R}}).then(g=>{const{list:w}=g.data,{data:k,per_page:S,current_page:E,total:I}=w;N.value=k,Q.value.page=E,Q.value.rowsNumber=I,Q.value.rowsPerPage=S}).catch(g=>{var w,k;i.notify({type:"negative",message:(k=(w=g==null?void 0:g.response)==null?void 0:w.data)==null?void 0:k.message})}).finally(()=>$.value=!1)}const pe=()=>{M.value&&c.put(route("remuneration.update",M.value),{onSuccess:()=>{U.value=!1,c.reset(),p.value&&p.value.requestServerInteraction(),i.notify({type:"positive",message:"Remuneration updated successfully."})},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})};function ve(){if(!d.next_increment_date){i.notify({type:"negative",message:"Please select a new increment date"});return}d.post(route("remuneration.bulk-update"),{preserveScroll:!0,onSuccess:()=>{i.notify({type:"positive",message:"Increment updated successfully"}),b.value=!1,x.value=[],d.reset(),p.value&&p.value.requestServerInteraction()},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})}const be=()=>{window.history.back()};return(o,e)=>(O(),T(Ve,{class:"container",padding:""},{default:n(()=>[l("div",he,[l("div",null,[e[11]||(e[11]=l("div",{class:"stitle"},"Remuneration Details",-1)),t(ge,{class:"text-dark"},{default:n(()=>[t(W,{onClick:e[0]||(e[0]=a=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),t(W,{class:"cursor-pointer",label:"Go Back",onClick:be})]),_:1})])]),e[21]||(e[21]=l("br",null,null,-1)),t(j,{flat:""},{default:n(()=>[t(_,null,{default:n(()=>[l("div",Ue,[t(j,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:n(()=>[t(_,null,{default:n(()=>[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),l("div",Ie,[t(J,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:m.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=a=>m.value.offices=a),se],options:v.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:F},null,8,["modelValue","options"]),t(J,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Increment Year",modelValue:m.value.incrementYear,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.incrementYear=a),options:u(Y),"emit-value":"","map-options":"",onClear:F},null,8,["modelValue","options"])])]),_:1,__:[12]}),t(ke),t(_,{class:"row items-center justify-between q-gutter-md"},{default:n(()=>[l("div",Ne,[v.canGenerateRemuneration?(O(),T(q,{key:0,label:"Get Employee",color:"primary",onClick:le})):H("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[22]||(e[22]=l("br",null,null,-1)),G.value?(O(),T(qe,{key:0,ref_key:"empTable",ref:p,title:"Employees Remuneration",rows:N.value,columns:re,"row-key":"id",loading:$.value,pagination:Q.value,"onUpdate:pagination":e[4]||(e[4]=a=>Q.value=a),"rows-per-page-options":[5,10,20,50],onRequest:fe,selection:"multiple",selected:x.value,"onUpdate:selected":e[5]||(e[5]=a=>x.value=a)},{"top-right":n(()=>[x.value.length>0?(O(),T(q,{key:0,class:"q-mr-sm",icon:"upload",label:"Update",color:"primary",onClick:ue})):H("",!0),t(A,{dense:"",outlined:"",debounce:"800",modelValue:h.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>h.value=a),oe],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:n(()=>[t(X,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(f((s=a.row.office)==null?void 0:s.name),1)]}),_:2},1032,["props"])]),"body-cell-remuneration":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+f((s=a.row.remuneration_detail)==null?void 0:s.remuneration),1)]}),_:2},1032,["props"])]),"body-cell-round_total":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+f((s=a.row.remuneration_detail)==null?void 0:s.round_total),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_date":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(f(u(V)((s=a.row.remuneration_detail)==null?void 0:s.next_increment_date)),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_amount":n(a=>[t(D,{props:a},{default:n(()=>{var s;return[y(" ₹"+f((s=a.row.remuneration_detail)==null?void 0:s.total),1)]}),_:2},1032,["props"])]),"body-cell-actions":n(a=>[t(D,{props:a},{default:n(()=>[t(q,{dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:s=>ie(a.row),"aria-label":"Edit"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):H("",!0),t(Z,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=a=>U.value=a)},{default:n(()=>[t(j,{style:{"min-width":"400px"}},{default:n(()=>[t(_,null,{default:n(()=>e[13]||(e[13]=[l("div",{class:"text-h6"},"Edit Remuneration",-1)])),_:1,__:[13]}),t(_,{class:"q-gutter-md"},{default:n(()=>{var a,s,R,g,w,k,S,E;return[l("div",Re,[e[14]||(e[14]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),l("div",Se,f((a=B.value)==null?void 0:a.name),1)]),l("div",Ee,[e[15]||(e[15]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),l("div",Pe,f((s=B.value)==null?void 0:s.designation),1)]),l("div",Te,[e[16]||(e[16]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Office",-1)),l("div",Oe,f((g=(R=B.value)==null?void 0:R.office)==null?void 0:g.name),1)]),l("div",je,[e[17]||(e[17]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Current Remuneration (Total)",-1)),l("div",Ae,"Rs "+f(((k=(w=B.value)==null?void 0:w.remuneration_detail)==null?void 0:k.total)||0),1)]),l("div",Ye,[e[18]||(e[18]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Next Increment",-1)),l("div",$e,f(u(V)((E=(S=B.value)==null?void 0:S.remuneration_detail)==null?void 0:E.next_increment_date)||0),1)]),t(A,{label:"Remuneration",type:"number",modelValue:u(c).remuneration,"onUpdate:modelValue":e[6]||(e[6]=I=>u(c).remuneration=I),outlined:"",dense:"",readonly:!C.value},{append:n(()=>[t(X,{name:"edit",class:"cursor-pointer",onClick:de})]),_:1},8,["modelValue","readonly"]),t(A,{label:"Next Increment Date",type:"date",modelValue:u(c).next_increment_date,"onUpdate:modelValue":e[7]||(e[7]=I=>u(c).next_increment_date=I),outlined:"",dense:"",readonly:!C.value},null,8,["modelValue","readonly"])]}),_:1}),t(ee,{align:"right"},{default:n(()=>[te(t(q,{flat:"",label:"Cancel",onClick:me},null,512),[[ae]]),t(q,{color:"primary",label:"Update",disable:!C.value,onClick:pe},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a)},{default:n(()=>[t(j,{style:{"min-width":"300px"}},{default:n(()=>[t(_,null,{default:n(()=>e[19]||(e[19]=[l("div",{class:"text-h6"},"Update Remuneration",-1)])),_:1,__:[19]}),t(_,null,{default:n(()=>[t(De,{class:"bg-grey-2 text-body2 q-pa-sm rounded-borders"},{default:n(()=>e[20]||(e[20]=[y(" Note: When updating the increment date, each selected employee’s "),l("strong",null,"remuneration",-1),y(" will be set to their "),l("strong",null,"next increment amount",-1),y(", and the new increment date will be applied based on this updated remuneration. ")])),_:1,__:[20]})]),_:1}),t(_,null,{default:n(()=>[t(A,{type:"date",modelValue:u(d).next_increment_date,"onUpdate:modelValue":e[9]||(e[9]=a=>u(d).next_increment_date=a),outlined:"",label:"New Increment Date",dense:"",error:!!u(d).errors.next_increment_date,"error-message":u(d).errors.next_increment_date},null,8,["modelValue","error","error-message"])]),_:1}),t(ee,{align:"right"},{default:n(()=>[te(t(q,{flat:"",label:"Cancel",onClick:ce},null,512),[[ae]]),t(q,{color:"primary",label:"Update",loading:u(d).processing,onClick:ve},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[21,22]}))}});export{at as default};
