import{Q as xe,a as L}from"./QBreadcrumbs-B4y-Iw47.js";import{Q as X}from"./QSelect-CqoD2GC0.js";import{H as ke,ad as he,J as qe,af as Ce,c as Z,n as T,I as W,r as u,x as ee,d as Q,o as B,w as n,e as l,i as a,g as N,y as $,z as w,u as c,p as Ve,q as x,h as k,t as g,Q as A,D as te,b6 as ae,br as ne,aA as le}from"./app-BKZzZdW9.js";import{Q as R}from"./QTd-Bd053nQs.js";import{Q as Ie}from"./QTable-DeEynLSQ.js";import{Q as De}from"./QLayout-DqdLlz7B.js";import{_ as Qe,C as oe}from"./BackendLayout-C0a8EOi0.js";import{u as Be}from"./use-quasar-yEAYruYz.js";import{u as Re}from"./useUtils-BwF3EynQ.js";import"./QChip-2jXGdexm.js";import"./format-DVjFHw3j.js";import"./QMarkupTable-DrZp38Ja.js";import"./use-fullscreen-BuswMVB4.js";import"./touch-BtXdfSmM.js";import"./QSlideTransition-4KgzU0H9.js";import"./date-DgFOktaR.js";const Se=ke({name:"QBanner",props:{...he,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(d,{slots:q}){const{proxy:{$q:j}}=qe(),s=Ce(d,j),F=Z(()=>"q-banner row items-center"+(d.dense===!0?" q-banner--dense":"")+(s.value===!0?" q-banner--dark q-dark":"")+(d.rounded===!0?" rounded-borders":"")),S=Z(()=>`q-banner__actions row items-center justify-end col-${d.inlineActions===!0?"auto":"all"}`);return()=>{const C=[T("div",{class:"q-banner__avatar col-auto row items-center self-start"},W(q.avatar)),T("div",{class:"q-banner__content col text-body2"},W(q.default))],_=W(q.action);return _!==void 0&&C.push(T("div",{class:S.value},_)),T("div",{class:F.value+(d.inlineActions===!1&&_!==void 0?" q-banner--top-padding":""),role:"alert"},C)}}}),Ue={class:"flex items-center justify-between q-pa-md bg-white"},Ee={class:"q-pa-md"},Ne={class:"row q-col-gutter-md"},Oe={class:"row q-gutter-sm col-12 col-sm justify-end"},Pe={class:"row q-mb-sm items-center"},Ye={class:"col-8 text-body1"},Te={class:"row q-mb-sm items-center"},$e={class:"col-8 text-body1"},Ae={class:"row q-mb-sm items-center"},je={class:"col-8 text-body1"},Fe={class:"row q-mb-sm items-center"},Ge={class:"col-8 text-body1"},Me={class:"row q-mb-sm items-center"},ze={class:"col-8 text-body1"},He={class:"row q-mb-sm items-center"},Je={class:"col-8 text-body1"},re=2020,We=2035,ct=Object.assign({layout:Qe},{__name:"Detail",props:["office","canGenerateRemuneration","canCreateRemuneration","canEditRemuneration","canBulkUpdateRemuneration"],setup(d){const{formatDate:q}=Re(),j=d,s=u({offices:[],incrementYear:""}),F=Array.from({length:We-re+1},(r,e)=>re+e),S=u(""),C=u([]),_=u(!1),m=Be(),U=u([]),G=u(!1),f=ee({employee_ids:[],next_increment_date:""}),V=u(!1),E=u(!1),M=u(!1),p=u(null);function se(){if(!s.value.offices||s.value.offices.length===0){m.notify({type:"negative",message:"Please select an office"});return}if(!s.value.incrementYear){m.notify({type:"negative",message:"Please enter the increment year"});return}M.value=!0,U.value=[],setTimeout(()=>{p.value&&p.value.requestServerInteraction()})}function ie(){I.value.page=1,p.value&&p.value.requestServerInteraction()}function z(){U.value=[],M.value=!1}function ue(r){(!r||r.length===0)&&z()}const v=ee({remuneration:"",next_increment_date:"",pay_matrix:""}),I=u({sortBy:"next_increment_date",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),de=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"remuneration",label:"Remuneration",field:"remuneration_detail.remuneration",align:"right"},{name:"round_total",label:"Total Monthly Remuneration",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.round_total",align:"right"},{name:"next_increment_date",label:"Date of Next Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.next_increment_date",align:"left"},{name:"next_increment_amount",label:"Remuneration After Increment",headerStyle:"white-space: normal; word-wrap: break-word;",field:"remuneration_detail.total",align:"left"},{name:"actions",label:"Actions",align:"center"}],H=u(null),h=u(null),me=r=>{h.value=r,r.remuneration_detail?(v.remuneration=r.remuneration_detail.total,v.next_increment_date=r.remuneration_detail.next_increment_date,v.pay_matrix=r.remuneration_detail.pay_matrix):v.reset(),H.value=r.id,E.value=!0,V.value=!1};function ce(){f.reset(),f.employee_ids=C.value.map(r=>r.id),_.value=!0}const fe=()=>{V.value=!0},pe=()=>{V.value=!1,E.value=!1,v.reset()},ve=()=>{_.value=!1,f.reset()};function ge(r){const{page:e,rowsPerPage:t,sortBy:o,descending:D}=r.pagination;G.value=!0,axios.get(route("remuneration.json-detail"),{params:{filter:{...s.value},page:e,rowsPerPage:t,search:S.value,sortBy:o,descending:D}}).then(i=>{const{list:b}=i.data,{data:y,per_page:O,current_page:P,total:Y}=b;U.value=y,I.value.page=P,I.value.rowsNumber=Y,I.value.rowsPerPage=O}).catch(i=>{var b,y;m.notify({type:"negative",message:(y=(b=i==null?void 0:i.response)==null?void 0:b.data)==null?void 0:y.message})}).finally(()=>G.value=!1)}const be=()=>{H.value&&v.put(route("remuneration.update",H.value),{onSuccess:()=>{E.value=!1,v.reset(),p.value&&p.value.requestServerInteraction(),m.notify({type:"positive",message:"Remuneration updated successfully."})},onError:r=>{Object.values(r).forEach(e=>{m.notify({type:"negative",message:e,position:"bottom"})})}})};function ye(){if(!f.next_increment_date){m.notify({type:"negative",message:"Please select a new increment date"});return}f.post(route("remuneration.bulk-update"),{preserveScroll:!0,onSuccess:()=>{m.notify({type:"positive",message:"Increment updated successfully"}),_.value=!1,C.value=[],f.reset(),p.value&&p.value.requestServerInteraction()},onError:r=>{Object.values(r).forEach(e=>{m.notify({type:"negative",message:e,position:"bottom"})})}})}const _e=()=>{window.history.back()};function we(){if(!s.value.offices||!s.value.incrementYear)return m.notify({type:"negative",message:"Please select Office(s) and Increment Year"});const e=`01-01-${parseInt(s.value.incrementYear)+1}`,t=Number(s.value.offices),o=j.office.find(i=>i.id===t),D=o?o.name:"Unknown Office";m.dialog({title:"Confirm Update",message:`
            <div>
                <p><strong>Selected Office:</strong> ${D}</p>
                <p><strong>Current Increment Year:</strong> ${s.value.incrementYear}</p>
                <p><strong>New Increment Date to Apply:</strong> ${e}</p>
                <br>
                <span style="color:#C62828"><strong>
                    This will update all employees matching the filters. Each employee’s
                    <strong>remuneration</strong> will be updated to their
                    <strong>next increment amount</strong>, and the new increment date will be applied.
                </strong></span>
            </div>
        `,html:!0,ok:{label:"Yes, Update",color:"primary"},cancel:{label:"Cancel",flat:!0}}).onOk(()=>{axios.post(route("remuneration.updateFilteredIncrementDate"),{offices:s.value.offices,incrementYear:s.value.incrementYear}).then(i=>{m.notify({type:"positive",message:i.data.message}),p.value&&p.value.requestServerInteraction()}).catch(i=>{var b,y;m.notify({type:"negative",message:(y=(b=i==null?void 0:i.response)==null?void 0:b.data)==null?void 0:y.message})})})}return(r,e)=>(B(),Q(De,{class:"container",padding:""},{default:n(()=>[l("div",Ue,[l("div",null,[e[10]||(e[10]=l("div",{class:"stitle"},"Provisional Employees Increment System",-1)),a(xe,{class:"text-dark"},{default:n(()=>[a(L,{onClick:e[0]||(e[0]=t=>r.$inertia.get(r.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),a(L,{class:"cursor-pointer",label:"Go Back",onClick:_e})]),_:1})])]),e[21]||(e[21]=l("br",null,null,-1)),a($,{flat:""},{default:n(()=>[a(w,null,{default:n(()=>[l("div",Ee,[a($,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:n(()=>[a(w,null,{default:n(()=>[e[11]||(e[11]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),l("div",Ne,[a(X,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:s.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>s.value.offices=t),ue],options:d.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:z},null,8,["modelValue","options"]),a(X,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Increment Year",modelValue:s.value.incrementYear,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.incrementYear=t),options:c(F),"emit-value":"","map-options":"",onClear:z},null,8,["modelValue","options"])])]),_:1,__:[11]}),a(Ve),a(w,{class:"row items-center justify-between q-gutter-md"},{default:n(()=>[l("div",Oe,[d.canGenerateRemuneration?(B(),Q(x,{key:0,label:"Get Employee",color:"primary",onClick:se})):N("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[22]||(e[22]=l("br",null,null,-1)),M.value?(B(),Q(Ie,{key:0,ref_key:"empTable",ref:p,title:"Employees Remuneration",rows:U.value,columns:de,"row-key":"id",loading:G.value,pagination:I.value,"onUpdate:pagination":e[4]||(e[4]=t=>I.value=t),"rows-per-page-options":[5,10,20,50],onRequest:ge},{"top-right":n(()=>[d.canBulkUpdateRemuneration&&U.value.length>0?(B(),Q(x,{key:0,class:"q-mr-sm",label:"Set New Increment Date",color:"primary",onClick:we})):N("",!0),C.value.length>0&&d.canBulkUpdateRemuneration?(B(),Q(x,{key:1,class:"q-mr-sm",icon:"upload",label:"Update",color:"primary",onClick:ce})):N("",!0),a(A,{dense:"",outlined:"",debounce:"800",modelValue:S.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>S.value=t),ie],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:n(()=>[a(te,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":n(t=>[a(R,{props:t},{default:n(()=>{var o;return[k(g((o=t.row.office)==null?void 0:o.name),1)]}),_:2},1032,["props"])]),"body-cell-remuneration":n(t=>[a(R,{props:t},{default:n(()=>{var o;return[k(" ₹"+g((o=t.row.remuneration_detail)==null?void 0:o.remuneration),1)]}),_:2},1032,["props"])]),"body-cell-round_total":n(t=>[a(R,{props:t},{default:n(()=>{var o;return[k(" ₹"+g((o=t.row.remuneration_detail)==null?void 0:o.round_total),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_date":n(t=>[a(R,{props:t},{default:n(()=>{var o;return[k(g(c(q)((o=t.row.remuneration_detail)==null?void 0:o.next_increment_date)),1)]}),_:2},1032,["props"])]),"body-cell-next_increment_amount":n(t=>[a(R,{props:t},{default:n(()=>{var o;return[k(" ₹"+g((o=t.row.remuneration_detail)==null?void 0:o.total),1)]}),_:2},1032,["props"])]),"body-cell-actions":n(t=>[a(R,{props:t},{default:n(()=>[d.canEditRemuneration?(B(),Q(x,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:o=>me(t.row),"aria-label":"Edit"},null,8,["onClick"])):N("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):N("",!0),a(ae,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=t=>E.value=t)},{default:n(()=>[a($,{style:{"min-width":"400px"}},{default:n(()=>[a(w,null,{default:n(()=>e[12]||(e[12]=[l("div",{class:"text-h6"},"Edit Remuneration",-1)])),_:1,__:[12]}),a(w,{class:"q-gutter-md"},{default:n(()=>{var t,o,D,i,b,y,O,P,Y,K;return[l("div",Pe,[e[13]||(e[13]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),l("div",Ye,g((t=h.value)==null?void 0:t.name),1)]),l("div",Te,[e[14]||(e[14]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),l("div",$e,g((o=h.value)==null?void 0:o.designation),1)]),l("div",Ae,[e[15]||(e[15]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Office",-1)),l("div",je,g((i=(D=h.value)==null?void 0:D.office)==null?void 0:i.name),1)]),l("div",Fe,[e[16]||(e[16]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Current Remuneration (Total)",-1)),l("div",Ge,"Rs "+g(((y=(b=h.value)==null?void 0:b.remuneration_detail)==null?void 0:y.total)||0),1)]),l("div",Me,[e[17]||(e[17]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Next Increment",-1)),l("div",ze,g(c(q)((P=(O=h.value)==null?void 0:O.remuneration_detail)==null?void 0:P.next_increment_date)||0),1)]),l("div",He,[e[18]||(e[18]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Pay Matrix",-1)),l("div",Je,g((K=(Y=h.value)==null?void 0:Y.remuneration_detail)==null?void 0:K.pay_matrix),1)]),a(A,{label:"Remuneration",type:"number",modelValue:c(v).remuneration,"onUpdate:modelValue":e[5]||(e[5]=J=>c(v).remuneration=J),outlined:"",dense:"",readonly:!V.value},{append:n(()=>[a(te,{name:"edit",class:"cursor-pointer",onClick:fe})]),_:1},8,["modelValue","readonly"]),a(A,{label:"Next Increment Date",type:"date",modelValue:c(v).next_increment_date,"onUpdate:modelValue":e[6]||(e[6]=J=>c(v).next_increment_date=J),outlined:"",dense:"",readonly:!V.value},null,8,["modelValue","readonly"])]}),_:1}),a(ne,{align:"right"},{default:n(()=>[le(a(x,{flat:"",label:"Cancel",onClick:pe},null,512),[[oe]]),a(x,{color:"primary",label:"Update",disable:!V.value,onClick:be},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ae,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t)},{default:n(()=>[a($,{style:{"min-width":"300px"}},{default:n(()=>[a(w,null,{default:n(()=>e[19]||(e[19]=[l("div",{class:"text-h6"},"Update Remuneration",-1)])),_:1,__:[19]}),a(w,null,{default:n(()=>[a(Se,{class:"bg-grey-2 text-body2 q-pa-sm rounded-borders"},{default:n(()=>e[20]||(e[20]=[k(" Note: When updating the increment date, each selected employee’s "),l("strong",null,"remuneration",-1),k(" will be set to their "),l("strong",null,"next increment amount",-1),k(", and the new increment date will be applied based on this updated remuneration. ")])),_:1,__:[20]})]),_:1}),a(w,null,{default:n(()=>[a(A,{type:"date",modelValue:c(f).next_increment_date,"onUpdate:modelValue":e[8]||(e[8]=t=>c(f).next_increment_date=t),outlined:"",label:"New Increment Date",dense:"",error:!!c(f).errors.next_increment_date,"error-message":c(f).errors.next_increment_date},null,8,["modelValue","error","error-message"])]),_:1}),a(ne,{align:"right"},{default:n(()=>[le(a(x,{flat:"",label:"Cancel",onClick:ve},null,512),[[oe]]),a(x,{color:"primary",label:"Update",loading:c(f).processing,onClick:ye},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[21,22]}))}});export{ct as default};
