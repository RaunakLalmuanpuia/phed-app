import{Q as ie,a as W}from"./QBreadcrumbs-BstBHHBZ.js";import{Q as F}from"./QSelect-KuKzlJo4.js";import{r as m,x as re,d as _,o as i,w as o,e as l,i as s,g as f,y as A,z as Q,p as Y,q as D,h as de,t as d,A as ue,D as H,u as E,Q as me,a0 as ce,f as h,F as pe,v as fe,G as ve,$ as ye,N as ge}from"./app-B4x0b1J0.js";import{a as be,Q as _e}from"./QLayout-AHtdX9WN.js";import{Q as I}from"./QTd-l60MFJ1S.js";import{Q as we}from"./QTable-CFUEP09B.js";import{Q as xe}from"./QFile-CuTPM8Rb.js";import{_ as ke,C as he}from"./BackendLayout-Bp9CIn2m.js";import{u as qe}from"./use-quasar-uXAp4LVg.js";import{u as Qe}from"./useUtils-CwvTXumT.js";/* empty css            */import"./QMarkupTable-CZOHEs9S.js";import"./use-fullscreen-DiYEQ72k.js";import"./touch-Yf2IcFTG.js";import"./QSlideTransition-C1vJK_5u.js";import"./date-C0RhUT-T.js";const De={class:"flex items-center justify-between q-pa-md bg-white"},Ee={class:"q-pa-md"},Ve={class:"row q-col-gutter-md"},Ce={class:"row q-gutter-sm col-12 col-sm justify-end"},Pe={class:"flex items-center gap-3"},Ue={class:"text-body1"},Te={class:"text-caption text-grey"},Se={class:"text-caption text-grey"},Be={class:"grid grid-cols-2 gap-4 items-start relative"},Ne={class:"row q-mb-sm items-center"},Re={class:"col-8 text-body1"},$e={class:"row q-mb-sm items-center"},je={class:"col-8 text-body1"},Fe={class:"row q-mb-sm items-center"},Ae={class:"col-8 text-body1"},Ie={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},Me={key:0,class:"row q-mb-sm items-center"},Ge={key:1,class:"row q-mb-sm items-center"},ze={key:2,class:"row q-mb-sm items-center"},Le={class:"col-8 text-body1"},We={key:3,class:"row q-mb-sm items-center"},Ye={class:"col-8 text-body1"},He={class:"text-subtitle2 q-mb-xs"},pt=Object.assign({layout:ke},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(V){const{formatDate:O}=Qe(),u=m({offices:[],type:null,scheme:null}),J=[{label:"MR",value:"MR"},{label:"PE",value:"PE"}],K=[{label:"No",value:"no"},{label:"Yes",value:"yes"}],B=m(""),v=qe(),C=m([]),N=m(!1),q=m(!1),R=m(!1),y=m(null);function X(){if(!u.value.offices||u.value.offices.length===0){v.notify({type:"negative",message:"Please select an office"});return}R.value=!0,C.value=[],setTimeout(()=>{y.value&&y.value.requestServerInteraction()})}function $(){w.value.page=1,y.value&&y.value.requestServerInteraction()}function j(){C.value=[],R.value=!1}function Z(a){(!a||a.length===0)&&j()}const c=re({documents:[]}),w=m({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),ee=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],P=m(null),r=m(null),te=a=>{r.value=a,P.value=a.id,c.documents=[],a.documents&&a.documents.length>0&&a.documents.forEach(e=>{c.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),q.value=!0},le=(a,e)=>{c.documents[a]={...c.documents[a],file:e}};function se(a){const{page:e,rowsPerPage:t,sortBy:n,descending:x}=a.pagination;N.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...u.value},page:e,rowsPerPage:t,search:B.value,sortBy:n,descending:x}}).then(p=>{const{list:g}=p.data,{data:b,per_page:U,current_page:T,total:S}=g;C.value=b,w.value.page=T,w.value.rowsNumber=S,w.value.rowsPerPage=U}).catch(p=>{var g,b;v.notify({type:"negative",message:(b=(g=p==null?void 0:p.response)==null?void 0:g.data)==null?void 0:b.message})}).finally(()=>N.value=!1)}const oe=()=>{if(!P.value)return;const a=new FormData;Object.entries(c.documents).forEach(([e,t])=>{t!=null&&t.file&&a.append(`documents[${e}]`,t.file)}),axios.post(route("document.update",P.value),a,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:t,message:n}=e;v.notify({type:"positive",message:n||"Employee saved successfully."}),y.value&&y.value.requestServerInteraction(),q.value=!1,c.documents=[],P.value=null}).catch(e=>{var t;if(e.response)if(e.response.status===422){const n=e.response.data.errors,x=n?Object.values(n)[0][0]:"Validation failed.";v.notify({type:"negative",message:x})}else v.notify({type:"negative",message:((t=e.response.data)==null?void 0:t.message)||"Something went wrong!"});else e.request?v.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):v.notify({type:"negative",message:"Unexpected error occurred."})})},ae=a=>{window.open(a,"_blank")},ne=()=>{window.history.back()};return(a,e)=>(i(),_(_e,{class:"container",padding:""},{default:o(()=>[l("div",De,[l("div",null,[e[8]||(e[8]=l("div",{class:"stitle"},"Employee Documents",-1)),s(ie,{class:"text-dark"},{default:o(()=>[s(W,{onClick:e[0]||(e[0]=t=>a.$inertia.get(a.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),s(W,{class:"cursor-pointer",label:"Go Back",onClick:ne})]),_:1})])]),e[20]||(e[20]=l("br",null,null,-1)),s(A,{flat:""},{default:o(()=>[s(Q,null,{default:o(()=>[l("div",Ee,[s(A,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[s(Q,null,{default:o(()=>[e[9]||(e[9]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),l("div",Ve,[s(F,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:u.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>u.value.offices=t),Z],options:V.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:j},null,8,["modelValue","options"]),s(F,{label:"Select Employment Type",class:"col-12 col-sm-4",modelValue:u.value.type,"onUpdate:modelValue":[e[2]||(e[2]=t=>u.value.type=t),$],options:J,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:j},null,8,["modelValue"]),u.value.type==="MR"?(i(),_(F,{key:0,label:"Is Scheme?",class:"col-12 col-sm-4",modelValue:u.value.scheme,"onUpdate:modelValue":[e[3]||(e[3]=t=>u.value.scheme=t),$],options:K,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue"])):f("",!0)])]),_:1,__:[9]}),s(Y),s(Q,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[l("div",Ce,[V.canUpdateDocument?(i(),_(D,{key:0,label:"Get Employee",color:"primary",onClick:X})):f("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[21]||(e[21]=l("br",null,null,-1)),R.value?(i(),_(we,{key:0,ref_key:"empTable",ref:y,title:"Employees Document",rows:C.value,columns:ee,"row-key":"id",loading:N.value,pagination:w.value,"onUpdate:pagination":e[5]||(e[5]=t=>w.value=t),"rows-per-page-options":[5,10,20,50],onRequest:se},{"top-right":o(()=>[s(me,{dense:"",outlined:"",debounce:"800",modelValue:B.value,"onUpdate:modelValue":[e[4]||(e[4]=t=>B.value=t),$],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[s(H,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-employee":o(t=>[s(I,{props:t},{default:o(()=>[l("div",Pe,[s(ue,null,{default:o(()=>[t.row.avatar?(i(),_(be,{key:0,src:`/storage/${t.row.avatar}`},null,8,["src"])):(i(),_(H,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),l("div",null,[l("div",Ue,d(t.row.name),1),l("div",Te,d(t.row.mobile),1),l("div",Se,d(E(O)(t.row.date_of_birth)),1)])])]),_:2},1032,["props"])]),"body-cell-office":o(t=>[s(I,{props:t},{default:o(()=>{var n;return[de(d((n=t.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(t=>[s(I,{props:t},{default:o(()=>[V.canUpdateDocument?(i(),_(D,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:n=>te(t.row),"aria-label":"Edit"},null,8,["onClick"])):f("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):f("",!0),s(ce,{modelValue:q.value,"onUpdate:modelValue":e[7]||(e[7]=t=>q.value=t)},{default:o(()=>[s(A,{style:{"min-width":"750px"}},{default:o(()=>[s(Q,null,{default:o(()=>e[10]||(e[10]=[l("div",{class:"text-lg font-bold"},"Update Docment",-1)])),_:1,__:[10]}),s(Q,{class:"q-gutter-md"},{default:o(()=>{var t,n,x,p,g,b,U,T,S,M;return[l("div",Be,[l("div",null,[l("div",Ne,[e[11]||(e[11]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),l("div",Re,d((t=r.value)==null?void 0:t.name),1)]),l("div",$e,[e[12]||(e[12]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Parent Name",-1)),l("div",je,d((n=r.value)==null?void 0:n.parent_name),1)]),l("div",Fe,[e[13]||(e[13]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Birth",-1)),l("div",Ae,d(E(O)((x=r.value)==null?void 0:x.date_of_birth)),1)]),l("div",Ie,[e[14]||(e[14]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Present Address",-1)),l("div",Oe,d((p=r.value)==null?void 0:p.address),1)]),((g=r.value)==null?void 0:g.employment_type)==="PE"?(i(),h("div",Me,e[15]||(e[15]=[l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),l("div",{class:"col-8 text-body1"},"Provisional Employee",-1)]))):f("",!0),((b=r.value)==null?void 0:b.employment_type)==="MR"?(i(),h("div",Ge,e[16]||(e[16]=[l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),l("div",{class:"col-8 text-body1"},"Muster Roll Employee",-1)]))):f("",!0),((U=r.value)==null?void 0:U.employment_type)==="PE"?(i(),h("div",ze,[e[17]||(e[17]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),l("div",Le,d((T=r.value)==null?void 0:T.designation),1)])):f("",!0),((S=r.value)==null?void 0:S.employment_type)==="MR"?(i(),h("div",We,[e[18]||(e[18]=l("div",{class:"col-4 text-subtitle2 text-grey-8"},"Post/Work Assigned",-1)),l("div",Ye,d((M=r.value)==null?void 0:M.post_assigned),1)])):f("",!0)]),e[19]||(e[19]=l("div",{class:"absolute top-0 bottom-0 left-1/2 w-px bg-gray-300"},null,-1)),l("div",null,[(i(!0),h(pe,null,fe(V.documentTypes,(k,Je)=>{var G,z;return i(),h("div",{class:"col-12 col-sm-6",key:k.id},[l("div",He,d(k.name),1),s(xe,{filled:"","model-value":((G=E(c).documents[k.id])==null?void 0:G.file)||null,"onUpdate:modelValue":L=>le(k.id,L),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},ve({_:2},[(z=E(c).documents[k.id])!=null&&z.url?{name:"append",fn:o(()=>[s(D,{round:"",dense:"",flat:"",icon:"visibility",onClick:L=>ae(E(c).documents[k.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))])]),s(Y)]}),_:1}),s(ye,{align:"right"},{default:o(()=>[ge(s(D,{flat:"",label:"Cancel",onClick:e[6]||(e[6]=t=>!q.value)},null,512),[[he]]),s(D,{color:"primary",label:"Update",onClick:oe})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[20,21]}))}});export{pt as default};
