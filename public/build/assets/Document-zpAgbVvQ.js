import{Q as ne,a as L}from"./QBreadcrumbs-CNN97VEF.js";import{Q as W}from"./QSelect-DTkBNhuG.js";import{r as u,x as ie,d as k,o as i,w as o,e as t,i as s,g as b,y as N,z as h,p as H,q as D,h as re,t as d,A as de,D as J,u as E,Q as ue,a0 as me,f as q,F as ce,v as pe,G as fe,$ as ve,N as ye}from"./app-B3_kA3DU.js";import{a as ge,Q as be}from"./QLayout-CjoRmTJb.js";import{Q as R}from"./QTd-rXDVKVud.js";import{Q as _e}from"./QTable-Dlu-zh3T.js";import{Q as we}from"./QFile-DuWyITEw.js";import{_ as xe,C as ke}from"./BackendLayout-B1DN56kQ.js";import{u as qe}from"./use-quasar-DWF58T8G.js";import{u as Qe}from"./useUtils-qxYkR6L5.js";import"./QMarkupTable-b45L7n9P.js";import"./use-fullscreen-Dif6khKC.js";import"./touch-BmO7lSjr.js";import"./QSlideTransition-B8wZYg_w.js";import"./date-DnzKMU2l.js";const he={class:"flex items-center justify-between q-pa-md bg-white"},De={class:"q-pa-md"},Ee={class:"row q-col-gutter-md"},Ce={class:"row q-gutter-sm col-12 col-sm justify-end"},Ve={class:"flex items-center gap-3"},Pe={class:"text-body1"},Ue={class:"text-caption text-grey"},Te={class:"text-caption text-grey"},Se={class:"grid grid-cols-2 gap-4 items-start relative"},Be={class:"row q-mb-sm items-center"},$e={class:"col-8 text-body1"},je={class:"row q-mb-sm items-center"},Ne={class:"col-8 text-body1"},Re={class:"row q-mb-sm items-center"},Fe={class:"col-8 text-body1"},Ae={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},Ie={key:0,class:"row q-mb-sm items-center"},Me={key:1,class:"row q-mb-sm items-center"},Ge={key:2,class:"row q-mb-sm items-center"},ze={class:"col-8 text-body1"},Le={key:3,class:"row q-mb-sm items-center"},We={class:"col-8 text-body1"},He={class:"text-subtitle2 q-mb-xs"},mt=Object.assign({layout:xe},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(C){const{formatDate:F}=Qe(),p=u({offices:[],type:null}),K=[{label:"MR",value:"MR"},{label:"PE",value:"PE"}],B=u(""),f=qe(),V=u([]),$=u(!1),Q=u(!1),j=u(!1),v=u(null);function X(){if(!p.value.offices||p.value.offices.length===0){f.notify({type:"negative",message:"Please select an office"});return}j.value=!0,V.value=[],setTimeout(()=>{v.value&&v.value.requestServerInteraction()})}function A(){_.value.page=1,v.value&&v.value.requestServerInteraction()}function O(){V.value=[],j.value=!1}function Y(a){(!a||a.length===0)&&O()}const m=ie({documents:[]}),_=u({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),Z=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],P=u(null),r=u(null),ee=a=>{r.value=a,P.value=a.id,m.documents=[],a.documents&&a.documents.length>0&&a.documents.forEach(e=>{m.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),Q.value=!0},te=(a,e)=>{m.documents[a]={...m.documents[a],file:e}};function le(a){const{page:e,rowsPerPage:l,sortBy:n,descending:w}=a.pagination;$.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...p.value},page:e,rowsPerPage:l,search:B.value,sortBy:n,descending:w}}).then(c=>{const{list:y}=c.data,{data:g,per_page:U,current_page:T,total:S}=y;V.value=g,_.value.page=T,_.value.rowsNumber=S,_.value.rowsPerPage=U}).catch(c=>{var y,g;f.notify({type:"negative",message:(g=(y=c==null?void 0:c.response)==null?void 0:y.data)==null?void 0:g.message})}).finally(()=>$.value=!1)}const se=()=>{if(!P.value)return;const a=new FormData;Object.entries(m.documents).forEach(([e,l])=>{l!=null&&l.file&&a.append(`documents[${e}]`,l.file)}),axios.post(route("document.update",P.value),a,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:l,message:n}=e;f.notify({type:"positive",message:n||"Employee saved successfully."}),v.value&&v.value.requestServerInteraction(),Q.value=!1,m.documents=[],P.value=null}).catch(e=>{var l;if(e.response)if(e.response.status===422){const n=e.response.data.errors,w=n?Object.values(n)[0][0]:"Validation failed.";f.notify({type:"negative",message:w})}else f.notify({type:"negative",message:((l=e.response.data)==null?void 0:l.message)||"Something went wrong!"});else e.request?f.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):f.notify({type:"negative",message:"Unexpected error occurred."})})},oe=a=>{window.open(a,"_blank")},ae=()=>{window.history.back()};return(a,e)=>(i(),k(be,{class:"container",padding:""},{default:o(()=>[t("div",he,[t("div",null,[e[7]||(e[7]=t("div",{class:"stitle"},"Employee Documents",-1)),s(ne,{class:"text-dark"},{default:o(()=>[s(L,{onClick:e[0]||(e[0]=l=>a.$inertia.get(a.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),s(L,{class:"cursor-pointer",label:"Go Back",onClick:ae})]),_:1})])]),e[19]||(e[19]=t("br",null,null,-1)),s(N,{flat:""},{default:o(()=>[s(h,null,{default:o(()=>[t("div",De,[s(N,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[s(h,null,{default:o(()=>[e[8]||(e[8]=t("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),t("div",Ee,[s(W,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:p.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=l=>p.value.offices=l),Y],options:C.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:O},null,8,["modelValue","options"]),s(W,{label:"Select Employment Type",class:"col-12 col-sm-4",modelValue:p.value.type,"onUpdate:modelValue":[e[2]||(e[2]=l=>p.value.type=l),A],options:K,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue"])])]),_:1,__:[8]}),s(H),s(h,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[t("div",Ce,[C.canUpdateDocument?(i(),k(D,{key:0,label:"Get Employee",color:"primary",onClick:X})):b("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[20]||(e[20]=t("br",null,null,-1)),j.value?(i(),k(_e,{key:0,ref_key:"empTable",ref:v,title:"Employees Document",rows:V.value,columns:Z,"row-key":"id",loading:$.value,pagination:_.value,"onUpdate:pagination":e[4]||(e[4]=l=>_.value=l),"rows-per-page-options":[5,10,20,50],onRequest:le},{"top-right":o(()=>[s(ue,{dense:"",outlined:"",debounce:"800",modelValue:B.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>B.value=l),A],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[s(J,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-employee":o(l=>[s(R,{props:l},{default:o(()=>[t("div",Ve,[s(de,null,{default:o(()=>[l.row.avatar?(i(),k(ge,{key:0,src:`/storage/${l.row.avatar}`},null,8,["src"])):(i(),k(J,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),t("div",null,[t("div",Pe,d(l.row.name),1),t("div",Ue,d(l.row.mobile),1),t("div",Te,d(E(F)(l.row.date_of_birth)),1)])])]),_:2},1032,["props"])]),"body-cell-office":o(l=>[s(R,{props:l},{default:o(()=>{var n;return[re(d((n=l.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(l=>[s(R,{props:l},{default:o(()=>[C.canUpdateDocument?(i(),k(D,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:n=>ee(l.row),"aria-label":"Edit"},null,8,["onClick"])):b("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):b("",!0),s(me,{modelValue:Q.value,"onUpdate:modelValue":e[6]||(e[6]=l=>Q.value=l)},{default:o(()=>[s(N,{style:{"min-width":"750px"}},{default:o(()=>[s(h,null,{default:o(()=>e[9]||(e[9]=[t("div",{class:"text-lg font-bold"},"Update Docment",-1)])),_:1,__:[9]}),s(h,{class:"q-gutter-md"},{default:o(()=>{var l,n,w,c,y,g,U,T,S,I;return[t("div",Se,[t("div",null,[t("div",Be,[e[10]||(e[10]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),t("div",$e,d((l=r.value)==null?void 0:l.name),1)]),t("div",je,[e[11]||(e[11]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Parent Name",-1)),t("div",Ne,d((n=r.value)==null?void 0:n.parent_name),1)]),t("div",Re,[e[12]||(e[12]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Birth",-1)),t("div",Fe,d(E(F)((w=r.value)==null?void 0:w.date_of_birth)),1)]),t("div",Ae,[e[13]||(e[13]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Present Address",-1)),t("div",Oe,d((c=r.value)==null?void 0:c.address),1)]),((y=r.value)==null?void 0:y.employment_type)==="PE"?(i(),q("div",Ie,e[14]||(e[14]=[t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),t("div",{class:"col-8 text-body1"},"Provisional Employee",-1)]))):b("",!0),((g=r.value)==null?void 0:g.employment_type)==="MR"?(i(),q("div",Me,e[15]||(e[15]=[t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),t("div",{class:"col-8 text-body1"},"Muster Roll Employee",-1)]))):b("",!0),((U=r.value)==null?void 0:U.employment_type)==="PE"?(i(),q("div",Ge,[e[16]||(e[16]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),t("div",ze,d((T=r.value)==null?void 0:T.designation),1)])):b("",!0),((S=r.value)==null?void 0:S.employment_type)==="MR"?(i(),q("div",Le,[e[17]||(e[17]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Post/Work Assigned",-1)),t("div",We,d((I=r.value)==null?void 0:I.post_assigned),1)])):b("",!0)]),e[18]||(e[18]=t("div",{class:"absolute top-0 bottom-0 left-1/2 w-px bg-gray-300"},null,-1)),t("div",null,[(i(!0),q(ce,null,pe(C.documentTypes,(x,Je)=>{var M,G;return i(),q("div",{class:"col-12 col-sm-6",key:x.id},[t("div",He,d(x.name),1),s(we,{filled:"","model-value":((M=E(m).documents[x.id])==null?void 0:M.file)||null,"onUpdate:modelValue":z=>te(x.id,z),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},fe({_:2},[(G=E(m).documents[x.id])!=null&&G.url?{name:"append",fn:o(()=>[s(D,{round:"",dense:"",flat:"",icon:"visibility",onClick:z=>oe(E(m).documents[x.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))])]),s(H)]}),_:1}),s(ve,{align:"right"},{default:o(()=>[ye(s(D,{flat:"",label:"Cancel",onClick:e[5]||(e[5]=l=>!Q.value)},null,512),[[ke]]),s(D,{color:"primary",label:"Update",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[19,20]}))}});export{mt as default};
