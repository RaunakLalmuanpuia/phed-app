import{Q as T,a as q}from"./QBreadcrumbs-DVeUSRJF.js";import{r as u,l as I,d as _,o as k,w as t,e as n,i as l,t as m,q as Q,y as L,z as B,p as z,Q as F,D as C,h as P,u as E,A as M}from"./app-BZa_U_r9.js";import{Q as x,a as W}from"./QSelect-BvFBfcRP.js";import{a as G,Q as H}from"./QLayout-CvmrwXDZ.js";import{Q as y}from"./QTd-BSkg0iwX.js";import{Q as J}from"./QTable-Bawpc_L2.js";import{_ as K}from"./BackendLayout-DMP_RyRX.js";import{u as X}from"./use-quasar-CrRCImgW.js";import{u as Y}from"./useUtils-C7viLKc9.js";import"./format-_1yUbRvW.js";import"./QMarkupTable--V5RPu6x.js";import"./use-fullscreen-DRid0H0a.js";import"./touch-C0GTe0S2.js";import"./QSlideTransition-3sdT_ruZ.js";import"./date-DqZu8dUH.js";const Z={class:"flex items-center justify-between q-pa-md bg-white"},ee={class:"stitle"},ae={class:"q-gutter-sm"},le={class:"row q-col-gutter-md"},te={class:"row q-gutter-sm col-12 col-sm justify-end"},oe={class:"flex items-center gap-3"},se={class:"text-body1"},ne={class:"text-caption text-grey"},ie={class:"text-caption text-grey"},Ve=Object.assign({layout:K},{__name:"SchemeEmployees",props:["scheme","skills","educationQln","offices","canCreate","canEdit","canDelete"],setup(r){const{formatDate:S}=Y(),f=r,U=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"office",label:"Office",align:"left",field:"office",sortable:!0},{name:"post_assigned",label:"Post/Work Assigned",align:"left",field:"post_assigned",sortable:!1},{name:"name_of_workplace",label:"Workplace",align:"left",field:"name_of_workplace",sortable:!1},{name:"skill_at_present",label:"Skill At Present",align:"left",field:"skill_at_present",sortable:!0},{name:"date_of_engagement",label:"Date of Engagement",align:"left",field:"date_of_engagement",sortable:!0},{name:"actions",label:"Actions",align:"center"}],s=u({search:null,skill:null,education_qln:null,office:null});u("");const d=X(),V=u([]),w=u(!1),i=u({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),p=()=>{h({pagination:i.value,filter:s.value,search:s.value.search})};function h(o){const{page:a,rowsPerPage:e,sortBy:g,descending:re}=o.pagination,j=o.filter,A=o.search;w.value=!0,axios.get(route("employees.json-index-scheme",f.scheme),{params:{filter:j,page:a,rowsPerPage:e,search:A}}).then(c=>{console.log(c.data);const{list:b}=c.data,{data:v,per_page:N,current_page:R,total:O,to:de,from:ce}=b;V.value=v,i.value.page=R,i.value.rowsNumber=O,i.value.rowsPerPage=N}).catch(c=>{var b,v;d.notify({type:"negative",message:(v=(b=c==null?void 0:c.response)==null?void 0:b.data)==null?void 0:v.message})}).finally(()=>w.value=!1)}const $=()=>{if(d.loading.show(),!f.scheme){d.notify({type:"negative",message:"No scheme found to export"}),d.loading.hide();return}axios.get(route("export.scheme",f.scheme.id),{responseType:"blob"}).then(o=>{const a=window.URL.createObjectURL(new Blob([o.data])),e=document.createElement("a");e.href=a,e.setAttribute("download",(f.scheme.name||"employees").replace(/\s+/g,"_")+"_scheme_employees.xlsx"),e.click()}).catch(o=>{var a,e;d.notify({type:"negative",message:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to download file"})}).finally(()=>{d.loading.hide()})};I(()=>{h({pagination:i.value,filter:s.value,search:s.value.search})});const D=()=>{window.history.back()};return(o,a)=>(k(),_(H,{class:"container",padding:""},{default:t(()=>[n("div",Z,[n("div",null,[n("div",ee,"Scheme Employee List: "+m(r.scheme.name),1),l(T,{class:"text-dark"},{default:t(()=>[l(q,{class:"cursor-pointer",onClick:a[0]||(a[0]=e=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard"}),l(q,{class:"cursor-pointer",label:"Go Back",onClick:D})]),_:1})]),n("div",ae,[l(Q,{label:"MR Summary",color:"primary",onClick:a[1]||(a[1]=e=>o.$inertia.get(o.route("summary.mr")))})])]),a[8]||(a[8]=n("br",null,null,-1)),l(L,{flat:""},{default:t(()=>[l(B,null,{default:t(()=>[a[7]||(a[7]=n("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Search Filter ",-1)),n("div",le,[l(x,{label:"Select Office",class:"col-12 col-sm-4",modelValue:s.value.office,"onUpdate:modelValue":[a[2]||(a[2]=e=>s.value.office=e),p],options:r.offices,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"]),l(x,{label:"Select Present Skill",class:"col-12 col-sm-4",modelValue:s.value.skill,"onUpdate:modelValue":[a[3]||(a[3]=e=>s.value.skill=e),p],options:r.skills,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"]),l(x,{label:"Select Education Qln.",class:"col-12 col-sm-4",modelValue:s.value.education_qln,"onUpdate:modelValue":[a[4]||(a[4]=e=>s.value.education_qln=e),p],options:r.educationQln,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"])])]),_:1,__:[7]}),l(z),l(B,{class:"row items-center justify-between q-gutter-md"},{default:t(()=>[n("div",te,[l(Q,{label:"Export",icon:"desktop_windows",color:"primary",onClick:$}),l(F,{dense:"",outlined:"",debounce:"300",modelValue:s.value.search,"onUpdate:modelValue":[a[5]||(a[5]=e=>s.value.search=e),p],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:t(()=>[l(C,{name:"search"})]),_:1},8,["modelValue"])])]),_:1}),l(J,{flat:"",ref:"tableRef",title:r.scheme.name,rows:V.value,columns:U,"row-key":"id",pagination:i.value,"onUpdate:pagination":a[6]||(a[6]=e=>i.value=e),loading:w.value,filter:s.value,"binary-state-sort":"","rows-per-page-options":[5,10,15,30,50],onRequest:h},{"body-cell-employee":t(e=>[l(y,{props:e},{default:t(()=>[n("div",oe,[l(M,null,{default:t(()=>[e.row.avatar?(k(),_(G,{key:0,src:`/storage/${e.row.avatar}`},null,8,["src"])):(k(),_(C,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),n("div",null,[n("div",se,m(e.row.name),1),n("div",ne,m(e.row.mobile),1),n("div",ie,m(E(S)(e.row.date_of_birth)),1)])])]),_:2},1032,["props"])]),"body-cell-office":t(e=>[l(y,{props:e},{default:t(()=>[l(W,{color:"primary","text-color":"white",dense:""},{default:t(()=>{var g;return[P(m((g=e.row.office)==null?void 0:g.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-date_of_engagement":t(e=>[l(y,{props:e},{default:t(()=>[P(m(E(S)(e.row.date_of_engagement)),1)]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[l(y,{props:e},{default:t(()=>[l(Q,{dense:"",flat:"",round:"",color:"primary",icon:"visibility",onClick:g=>o.$inertia.get(o.route("employee.show",e.row.id)),"aria-label":"Show user"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["title","rows","pagination","loading","filter"])]),_:1})]),_:1,__:[8]}))}});export{Ve as default};
