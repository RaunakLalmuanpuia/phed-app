import{Q as ge,a as Z}from"./QBreadcrumbs-CATnAa52.js";import{r as g,x as O,d as y,o as _,w as r,e as p,i as t,g as w,q as c,y as U,z as E,Q as m,p as ve,h as G,t as V,u as l,D as be,b6 as x,E as j,br as R,aA as T}from"./app-C-F0Pl6B.js";import{Q as ye}from"./QSelect-CO_hcso5.js";import{Q as q}from"./QTd-DBaxHBrj.js";import{Q as _e}from"./QTable-CORf-dDd.js";import{Q as L}from"./QForm-BWbrT_zG.js";import{Q as Ve}from"./QLayout-C_r3fW1o.js";import{_ as we,C as h}from"./BackendLayout-CHxGLLS1.js";import{u as Ce}from"./use-quasar-DKhJcrZA.js";import{u as ke}from"./useUtils-CL1VaAf0.js";import"./QChip-CYtrk1bx.js";import"./format-BTIWOjr3.js";import"./QMarkupTable-DY9F3ZrT.js";import"./use-fullscreen-Dp6f4uqc.js";import"./touch-DLSvpzZM.js";import"./QSlideTransition-C_JFsmL5.js";import"./date-OWDYCUAe.js";const Ee={class:"flex items-center justify-between q-pa-md bg-white"},De={class:"q-gutter-sm"},Ue={class:"q-pa-md"},qe={class:"row q-col-gutter-md"},Ye={class:"row q-gutter-sm col-12 col-sm justify-end"},Se={class:"row q-col-gutter-md"},Pe={class:"subtitle"},Qe={class:"subtitle"},Ae={class:"row q-col-gutter-md"},Fe={class:"subtitle"},Be={class:"row q-col-gutter-md"},We=Object.assign({layout:we},{__name:"EngagementCard",props:["office","canGenerateEngagementCard","canCreateEngagementCard","canDownloadEngagementCard","canDeleteEngagementCard"],setup(v){const{formatDate:z}=ke(),M=v,f=g({offices:[],startYear:"",endYear:""}),I=g(""),J=g([]),s=Ce(),K=O({}),Y=g([]),N=g(!1),$=g(!1),b=g(null);function W(){if(!f.value.offices||f.value.offices.length===0){s.notify({type:"negative",message:"Please select an office"});return}if(!f.value.startYear){s.notify({type:"negative",message:"Please select the Start Year"});return}if(!f.value.endYear){s.notify({type:"negative",message:"Please select the End Year"});return}$.value=!0,Y.value=[],setTimeout(()=>{b.value&&b.value.requestServerInteraction()})}function X(){k.value.page=1,b.value&&b.value.requestServerInteraction()}function S(){Y.value=[],$.value=!1}function ee(n){(!n||n.length===0)&&S()}const k=g({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),ae=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left"},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"card_no",label:"Card No.",field:"engagement_card.card_no",align:"center"},{name:"start_date",label:"Start Date",field:"engagement_card.start_date",align:"center"},{name:"end_date",label:"End Date",field:"engagement_card.end_date",align:"center"},{name:"actions",label:"Actions",align:"center"}];function le(n){const{page:e,rowsPerPage:a,sortBy:o,descending:C}=n.pagination;N.value=!0,axios.get(route("mis.json-engagement-card"),{params:{filter:{...f.value},page:e,rowsPerPage:a,search:I.value,sortBy:o,descending:C}}).then(D=>{const{list:F}=D.data,{data:B,per_page:pe,current_page:fe,total:ce}=F;Y.value=B,k.value.page=fe,k.value.rowsNumber=ce,k.value.rowsPerPage=pe}).catch(D=>{var F,B;s.notify({type:"negative",message:(B=(F=D==null?void 0:D.response)==null?void 0:F.data)==null?void 0:B.message})}).finally(()=>N.value=!1)}const P=g(!1),H=g(null),Q=g(!1),i=O({employee_id:"",start_date:"",end_date:"",card_no:"",phed_file_no:"",letter_date:"",approval_dpar:"",approval_fin:""}),u=O({office_id:"",start_date:"",end_date:"",phed_file_no:"",letter_date:"",approval_dpar:"",approval_fin:""}),d=O({start_date:"",end_date:"",phed_file_no:"",letter_date:"",approval_dpar:"",approval_fin:""});function te(n){H.value=n,i.reset(),P.value=!0}function oe(){i.employee_id=H.value,i.post(route("engagement-card.generate"),{onSuccess:()=>{var n;s.notify({type:"positive",message:"Engagement card generated."}),P.value=!1,(n=b.value)==null||n.requestServerInteraction()},onError:n=>{Object.values(n).forEach(e=>{s.notify({type:"negative",message:e,position:"bottom"})})}})}const A=g(!1);function re(){u.reset(),u.office_id=f.value.offices,A.value=!0}function ne(){u.post(route("engagement-card.bulk-generate"),{onStart:n=>s.loading.show(),onSuccess:()=>{var n;s.notify({type:"positive",message:"Bulk engagement cards generated."}),A.value=!1,(n=b.value)==null||n.requestServerInteraction()},onError:n=>{Object.values(n).forEach(e=>{s.notify({type:"negative",message:e,position:"bottom"})})},onFinish:n=>s.loading.hide()})}function de(){d.post(route("engagement-card.all-office-bulk-generate"),{onStart:n=>s.loading.show({message:"Generating for all offices... Please wait."}),onSuccess:()=>{s.notify({type:"positive",message:"Bulk engagement cards generated for all office."}),Q.value=!1,d.reset()},onError:n=>{Object.values(n).forEach(e=>{s.notify({type:"negative",message:e,position:"bottom"})})},onFinish:n=>s.loading.hide()})}function se(n){s.dialog({title:"Confirm Deletion",message:"Are you sure you want to delete this Engagement Card?",ok:{label:"Yes",color:"primary"},cancel:{label:"No",color:"red"}}).onOk(()=>{K.delete(route("engagement-card.destroy",n),{onSuccess:()=>{var e;s.notify({type:"positive",message:"Engagement card deleted."}),(e=b.value)==null||e.requestServerInteraction()},onError:e=>{Object.values(e).forEach(a=>{s.notify({type:"negative",message:a,position:"bottom"})})}})}).onCancel(()=>{s.notify({type:"info",message:"Deletion cancelled.",color:"negative"})})}const ie=async n=>{try{const e=await axios.get(route("engagement-card.download",n),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data],{type:"application/pdf"})),o=document.createElement("a");o.href=a,o.setAttribute("download",`EngagementCard_${n.card_no}.pdf`),document.body.appendChild(o),o.click(),o.remove()}catch(e){s.notify({type:"negative",message:e})}},ue=async()=>{var n;try{const e=f.value.offices;s.loading.show({message:"Generating ZIP file... Please wait."});const a=await axios.post(route("engagement-card.bulk-download"),{office_id:e,start_date:`${f.value.startYear}-03-01`,end_date:`${f.value.endYear}-02-28`},{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([a.data],{type:"application/zip"})),C=document.createElement("a");C.href=o,C.setAttribute("download",`EngagementCards_${Date.now()}.zip`),document.body.appendChild(C),C.click(),C.remove(),(n=b.value)==null||n.requestServerInteraction(),J.value=[],s.notify({type:"positive",message:"ZIP downloaded successfully."})}catch(e){s.notify({type:"negative",message:"No Engagement card to Download"}),console.error(e)}finally{s.loading.hide()}},me=()=>{window.history.back()};return(n,e)=>(_(),y(Ve,{class:"container",padding:""},{default:r(()=>[p("div",Ee,[p("div",null,[e[32]||(e[32]=p("div",{class:"stitle"},"Engagement Card",-1)),t(ge,{class:"text-dark"},{default:r(()=>[t(Z,{onClick:e[0]||(e[0]=a=>n.$inertia.get(n.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),t(Z,{class:"cursor-pointer",label:"Go Back",onClick:me})]),_:1})]),p("div",De,[v.canCreateEngagementCard?(_(),y(c,{key:0,label:"All OFFICE CARD GENERATION",color:"primary",onClick:e[1]||(e[1]=a=>Q.value=!0)})):w("",!0)])]),e[38]||(e[38]=p("br",null,null,-1)),t(U,{flat:""},{default:r(()=>[t(E,null,{default:r(()=>[p("div",Ue,[t(U,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:r(()=>[t(E,null,{default:r(()=>[e[33]||(e[33]=p("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),p("div",qe,[t(ye,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:f.value.offices,"onUpdate:modelValue":[e[2]||(e[2]=a=>f.value.offices=a),ee],options:v.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:S},null,8,["modelValue","options"]),t(m,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Start Year",modelValue:f.value.startYear,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value.startYear=a),mask:"####",placeholder:"YYYY",onClear:S},null,8,["modelValue"]),t(m,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"End Year",modelValue:f.value.endYear,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value.endYear=a),mask:"####",placeholder:"YYYY",onClear:S},null,8,["modelValue"])])]),_:1,__:[33]}),t(ve),t(E,{class:"row items-center justify-between q-gutter-md"},{default:r(()=>[p("div",Ye,[v.canGenerateEngagementCard?(_(),y(c,{key:0,label:"Get Employee",color:"primary",onClick:W})):w("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[39]||(e[39]=p("br",null,null,-1)),$.value?(_(),y(_e,{key:0,ref_key:"empTable",ref:b,title:"Employees Engagement Cards",rows:Y.value,columns:ae,"row-key":"id",loading:N.value,pagination:k.value,"onUpdate:pagination":e[7]||(e[7]=a=>k.value=a),"rows-per-page-options":[5,10,20,50],onRequest:le},{"top-right":r(()=>[v.canCreateEngagementCard?(_(),y(c,{key:0,class:"q-mr-sm",icon:"picture_as_pdf",label:"Generate Cards",color:"primary",onClick:e[5]||(e[5]=a=>re())})):w("",!0),v.canDownloadEngagementCard?(_(),y(c,{key:1,class:"q-mr-sm",icon:"download",label:"Download ZIP",color:"primary",onClick:ue})):w("",!0),t(m,{dense:"",outlined:"",debounce:"800",modelValue:I.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>I.value=a),X],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:r(()=>[t(be,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":r(a=>[t(q,{props:a},{default:r(()=>{var o;return[G(V((o=a.row.office)==null?void 0:o.name),1)]}),_:2},1032,["props"])]),"body-cell-card_no":r(a=>[t(q,{props:a},{default:r(()=>{var o;return[G(V(((o=a.row.engagement_card[0])==null?void 0:o.card_no)??"Not Generated"),1)]}),_:2},1032,["props"])]),"body-cell-start_date":r(a=>[t(q,{props:a},{default:r(()=>{var o;return[G(V(l(z)((o=a.row.engagement_card[0])==null?void 0:o.start_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-end_date":r(a=>[t(q,{props:a},{default:r(()=>{var o;return[G(V(l(z)((o=a.row.engagement_card[0])==null?void 0:o.end_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-actions":r(a=>[t(q,{props:a},{default:r(()=>[v.canCreateEngagementCard?(_(),y(c,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"picture_as_pdf",onClick:o=>te(a.row.id),"aria-label":"Generate Card"},null,8,["onClick"])):w("",!0),a.row.engagement_card[0]&&v.canDownloadEngagementCard?(_(),y(c,{key:1,dense:"",flat:"",round:"",color:"primary",icon:"download",onClick:o=>ie(a.row.engagement_card[0]),"aria-label":"Generate Card"},null,8,["onClick"])):w("",!0),a.row.engagement_card[0]&&v.canDeleteEngagementCard?(_(),y(c,{key:2,dense:"",flat:"",round:"",color:"red",icon:"delete",onClick:o=>se(a.row.engagement_card[0].id),"aria-label":"Delete Card"},null,8,["onClick"])):w("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):w("",!0),t(x,{modelValue:P.value,"onUpdate:modelValue":e[15]||(e[15]=a=>P.value=a)},{default:r(()=>[t(U,null,{default:r(()=>[t(E,{class:"q-pa-md"},{default:r(()=>[e[34]||(e[34]=p("div",{class:"text-h6 q-mb-md"},"Generate Engagement Card",-1)),t(L,{onSubmit:j(oe,["prevent"])},{default:r(()=>[p("div",Se,[t(m,{filled:"",modelValue:l(i).start_date,"onUpdate:modelValue":e[8]||(e[8]=a=>l(i).start_date=a),label:"Start Date",type:"date",class:"col-6",error:l(i).errors.start_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(i).end_date,"onUpdate:modelValue":e[9]||(e[9]=a=>l(i).end_date=a),label:"End Date",type:"date",class:"col-6",error:l(i).errors.end_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(i).phed_file_no,"onUpdate:modelValue":e[10]||(e[10]=a=>l(i).phed_file_no=a),label:"PHED File Number",class:"col-8",error:l(i).errors.phed_file_no},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(i).letter_date,"onUpdate:modelValue":e[11]||(e[11]=a=>l(i).letter_date=a),label:"Letter Date",type:"date",class:"col-4",error:l(i).errors.letter_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(i).approval_dpar,"onUpdate:modelValue":e[12]||(e[12]=a=>l(i).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:l(i).errors.approval_dpar},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(i).approval_fin,"onUpdate:modelValue":e[13]||(e[13]=a=>l(i).approval_fin=a),label:"Approval Finance",class:"col-12",error:l(i).errors.approval_fin},null,8,["modelValue","error"])]),t(R,{align:"right"},{default:r(()=>[T(t(c,{flat:"",label:"Cancel",color:"negative",onClick:e[14]||(e[14]=a=>l(i).reset())},null,512),[[h]]),t(c,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[34]})]),_:1})]),_:1},8,["modelValue"]),t(x,{modelValue:A.value,"onUpdate:modelValue":e[23]||(e[23]=a=>A.value=a)},{default:r(()=>[t(U,null,{default:r(()=>[t(E,{class:"q-pa-md"},{default:r(()=>{var a;return[e[35]||(e[35]=p("div",{class:"text-h6 q-mb-md"},"Generate Bulk Cards",-1)),p("div",Pe,"Office : "+V(((a=M.office.find(o=>o.id===f.value.offices))==null?void 0:a.name)||""),1),p("div",Qe,"Fiscal Year : "+V(f.value.startYear)+" - "+V(f.value.endYear),1),t(L,{onSubmit:j(ne,["prevent"])},{default:r(()=>[p("div",Ae,[t(m,{filled:"",modelValue:l(u).start_date,"onUpdate:modelValue":e[16]||(e[16]=o=>l(u).start_date=o),label:"Start Date",type:"date",class:"col-6",error:l(u).errors.start_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(u).end_date,"onUpdate:modelValue":e[17]||(e[17]=o=>l(u).end_date=o),label:"End Date",type:"date",class:"col-6",error:l(u).errors.end_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(u).phed_file_no,"onUpdate:modelValue":e[18]||(e[18]=o=>l(u).phed_file_no=o),label:"PHED File Number",class:"col-8",error:l(u).errors.phed_file_no},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(u).letter_date,"onUpdate:modelValue":e[19]||(e[19]=o=>l(u).letter_date=o),label:"Letter Date",type:"date",class:"col-4",error:l(u).errors.letter_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(u).approval_dpar,"onUpdate:modelValue":e[20]||(e[20]=o=>l(u).approval_dpar=o),label:"Approval DP&AR",class:"col-12",error:l(u).errors.approval_dpar},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(u).approval_fin,"onUpdate:modelValue":e[21]||(e[21]=o=>l(u).approval_fin=o),label:"Approval Finance",class:"col-12",error:l(u).errors.approval_fin},null,8,["modelValue","error"])]),t(R,{align:"right"},{default:r(()=>[T(t(c,{flat:"",label:"Cancel",color:"negative",onClick:e[22]||(e[22]=o=>l(u).reset())},null,512),[[h]]),t(c,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]}),_:1,__:[35]})]),_:1})]),_:1},8,["modelValue"]),t(x,{modelValue:Q.value,"onUpdate:modelValue":e[31]||(e[31]=a=>Q.value=a)},{default:r(()=>[t(U,null,{default:r(()=>[t(E,{class:"q-pa-md"},{default:r(()=>[e[36]||(e[36]=p("div",{class:"text-h6 q-mb-md"},"Generate All Office Cards",-1)),e[37]||(e[37]=p("div",{class:"subtitle"},"Office : All",-1)),p("div",Fe," Fiscal Year : "+V(l(d).start_date?new Date(l(d).start_date).getFullYear():"")+" - "+V(l(d).end_date?new Date(l(d).end_date).getFullYear():""),1),t(L,{onSubmit:j(de,["prevent"])},{default:r(()=>[p("div",Be,[t(m,{filled:"",modelValue:l(d).start_date,"onUpdate:modelValue":e[24]||(e[24]=a=>l(d).start_date=a),label:"Start Date",type:"date",class:"col-6",error:l(d).errors.start_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(d).end_date,"onUpdate:modelValue":e[25]||(e[25]=a=>l(d).end_date=a),label:"End Date",type:"date",class:"col-6",error:l(d).errors.end_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(d).phed_file_no,"onUpdate:modelValue":e[26]||(e[26]=a=>l(d).phed_file_no=a),label:"PHED File Number",class:"col-8",error:l(d).errors.phed_file_no},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(d).letter_date,"onUpdate:modelValue":e[27]||(e[27]=a=>l(d).letter_date=a),label:"Letter Date",type:"date",class:"col-4",error:l(d).errors.letter_date},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(d).approval_dpar,"onUpdate:modelValue":e[28]||(e[28]=a=>l(d).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:l(d).errors.approval_dpar},null,8,["modelValue","error"]),t(m,{filled:"",modelValue:l(d).approval_fin,"onUpdate:modelValue":e[29]||(e[29]=a=>l(d).approval_fin=a),label:"Approval Finance",class:"col-12",error:l(d).errors.approval_fin},null,8,["modelValue","error"])]),t(R,{align:"right"},{default:r(()=>[T(t(c,{flat:"",label:"Cancel",color:"negative",onClick:e[30]||(e[30]=a=>l(d).reset())},null,512),[[h]]),t(c,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[36,37]})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[38,39]}))}});export{We as default};
