import{Q as M,a as V}from"./QBreadcrumbs-CjQB72kF.js";import{Q as x}from"./QSelect-VC1b8VuD.js";import{r as f,l as z,d as Q,o as g,w as l,g as r,i as a,y as D,z as C,u as G,q as y,e as R,h as _,t as u,A as W,D as $,Q as H}from"./app-E2q6TpZQ.js";import{a as J,Q as K}from"./QLayout-2p5ph-hK.js";import{Q as c}from"./QTd-DyxJdioY.js";import{Q as X}from"./QChip-CZ0n9mQ8.js";import{Q as Z}from"./QTable-RLkykN7x.js";import{_ as ee}from"./BackendLayout-Cgcv86pp.js";import{u as te}from"./use-quasar-CNbaCbb_.js";import"./format-Bl2yNtZf.js";import"./QMarkupTable-BG3F4_f-.js";import"./use-fullscreen-9MTSoC1m.js";import"./touch-C3Yxwow6.js";import"./QSlideTransition-BKoCmltV.js";const ae={class:"flex items-center justify-between q-pa-md bg-white"},oe={class:"q-pa-md"},le={class:"row q-col-gutter-md"},se={class:"row q-gutter-sm col-12 col-sm justify-end"},ne={class:"flex items-center gap-3"},re={class:"text-body1"},ie={class:"text-caption text-grey"},de={class:"text-caption text-grey"},ue={key:0},ce={key:1},B=2020,me=2040,$e=Object.assign({layout:ee},{__name:"DeletedEmployees",props:["office","canCreate","canEdit","canDelete"],setup(q){const S=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"type",label:"Employment Type",align:"left",field:"type",sortable:!0},{name:"designation",label:"Designation",align:"left",field:"designation",sortable:!0},{name:"office",label:"Office",align:"left",field:"office",sortable:!0},{name:"reason",label:"Reason",align:"left",field:"reason",sortable:!1},{name:"year",label:"Year",align:"left",field:"year",sortable:!1},{name:"supporting_document",label:"Document",align:"center",field:"supporting_document",sortable:!1},{name:"actions",label:"Actions",align:"center"}],n=f({office:null,reason:null,year:new Date().getFullYear()}),P=Array.from({length:me-B+1},(o,t)=>B+t),A=o=>o.designation&&o.date_of_retirement?"Work Charge":o.designation&&!o.date_of_retirement?"Provisional":"Muster Roll",b=f(""),i=te(),E=f([]),k=f(!1),d=f({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),v=()=>{n.value.search=b.value,p({pagination:d.value,filter:n.value,search:n.value.search})};function p(o){const{page:t,rowsPerPage:e,sortBy:s,descending:pe}=o.pagination,j=o.filter,N=o.search;k.value=!0,axios.get(route("employees.json-index-deleted"),{params:{filter:j,page:t,rowsPerPage:e,search:N}}).then(m=>{console.log(m.data);const{list:w}=m.data,{data:h,per_page:F,current_page:L,total:I,to:fe,from:ge}=w;E.value=h,d.value.page=L,d.value.rowsNumber=I,d.value.rowsPerPage=F}).catch(m=>{var w,h;i.notify({type:"negative",message:(h=(w=m==null?void 0:m.response)==null?void 0:w.data)==null?void 0:h.message})}).finally(()=>k.value=!1)}z(()=>{p({pagination:d.value,filter:n.value,search:n.value.search})});const O=o=>{i.dialog({title:"Confirm",message:`Are you sure you want to move <b>${o.name}</b> to trash?`,html:!0,cancel:!0,persistent:!0,ok:{label:"Yes, Move to Trash",color:"negative"}}).onOk(async()=>{try{await axios.delete(route("employee.destroy",o)),i.notify({type:"positive",message:`Employee ${o.name} moved to trash`}),p({pagination:d.value,filter:n.value,search:n.value.search})}catch{i.notify({type:"negative",message:"Failed to move employee to trash. Please try again."})}})},U=()=>{window.history.back()},T=()=>{i.loading.show(),axios.get(route("export.deleted"),{responseType:"blob"}).then(o=>{const t=window.URL.createObjectURL(new Blob([o.data])),e=document.createElement("a");e.href=t,e.setAttribute("download",Date.now()+".xlsx"),e.click()}).catch(o=>{var t,e;i.notify({type:"negative",message:((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to download file"})}).finally(()=>{i.loading.hide()})},Y=o=>{i.dialog({title:"Confirm Restore",message:`Are you sure you want to restore <b>${o.name}</b>?`,html:!0,cancel:!0,persistent:!0,ok:{label:"Yes, Restore",color:"positive"}}).onOk(async()=>{var t,e;try{await axios.put(route("employee.restore-delete",o)),i.notify({type:"positive",message:`Employee ${o.name} restored successfully`}),p({pagination:d.value,filter:n.value,search:b.value})}catch(s){i.notify({type:"negative",message:((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to restore employee"})}})};return(o,t)=>(g(),Q(K,{class:"container",padding:""},{default:l(()=>[r("div",ae,[r("div",null,[t[6]||(t[6]=r("div",{class:"stitle"},"Deleted Employee List",-1)),a(M,{class:"text-dark"},{default:l(()=>[a(V,{class:"cursor-pointer",onClick:t[0]||(t[0]=e=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard"}),a(V,{class:"cursor-pointer",label:"Go Back",onClick:U})]),_:1})])]),t[8]||(t[8]=r("br",null,null,-1)),a(D,{flat:""},{default:l(()=>[a(C,null,{default:l(()=>[r("div",oe,[a(D,{flat:"",bordered:"",class:"q-mt-md bg-white shadow-1"},{default:l(()=>[a(C,null,{default:l(()=>[t[7]||(t[7]=r("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Search Filter ",-1)),r("div",le,[a(x,{label:"Select Office",class:"col-12 col-sm-4",modelValue:n.value.office,"onUpdate:modelValue":[t[1]||(t[1]=e=>n.value.office=e),v],options:q.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"]),a(x,{dense:"",outlined:"",debounce:"300",modelValue:n.value.reason,"onUpdate:modelValue":[t[2]||(t[2]=e=>n.value.reason=e),v],options:["Expired","Resigned","Dismissed","Regularised","Others (Specify the reasons to Remarks)"],label:"Select Reason",class:"col-12 col-sm-4","emit-value":"","map-options":"",clearable:""},null,8,["modelValue"]),a(x,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Year",modelValue:n.value.year,"onUpdate:modelValue":[t[3]||(t[3]=e=>n.value.year=e),v],options:G(P),"emit-value":"","map-options":""},null,8,["modelValue","options"])])]),_:1,__:[7]})]),_:1})])]),_:1}),a(C,{class:"row items-center justify-between q-gutter-md"},{default:l(()=>[r("div",se,[a(y,{label:"Export",icon:"desktop_windows",color:"primary",onClick:T})])]),_:1}),a(Z,{flat:"",ref:"tableRef",title:"List of Deleted Employees",rows:E.value,columns:S,"row-key":"id",pagination:d.value,"onUpdate:pagination":t[5]||(t[5]=e=>d.value=e),loading:k.value,filter:n.value,"binary-state-sort":"","rows-per-page-options":[1,7,15,30,50],onRequest:p},{"top-right":l(()=>[a(H,{dense:"",outlined:"",debounce:"800",modelValue:b.value,"onUpdate:modelValue":[t[4]||(t[4]=e=>b.value=e),v],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:l(()=>[a($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-employee":l(e=>[a(c,{props:e},{default:l(()=>[r("div",ne,[a(W,null,{default:l(()=>[e.row.avatar?(g(),Q(J,{key:0,src:`/storage/${e.row.avatar}`},null,8,["src"])):(g(),Q($,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),r("div",null,[r("div",re,u(e.row.name),1),r("div",ie,u(e.row.mobile),1),r("div",de,u(e.row.date_of_birth),1)])])]),_:2},1032,["props"])]),"body-cell-type":l(e=>[a(c,{props:e},{default:l(()=>[_(u(A(e.row)),1)]),_:2},1032,["props"])]),"body-cell-office":l(e=>[a(c,{props:e},{default:l(()=>[a(X,{color:"primary","text-color":"white",dense:""},{default:l(()=>{var s;return[_(u((s=e.row.office)==null?void 0:s.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-reason":l(e=>[a(c,{props:e},{default:l(()=>{var s;return[_(u((s=e.row.deletion_detail)==null?void 0:s.reason),1)]}),_:2},1032,["props"])]),"body-cell-year":l(e=>[a(c,{props:e},{default:l(()=>{var s;return[_(u((s=e.row.deletion_detail)==null?void 0:s.year),1)]}),_:2},1032,["props"])]),"body-cell-supporting_document":l(e=>[a(c,{props:e},{default:l(()=>{var s;return[(s=e.row.deletion_detail)!=null&&s.supporting_document?(g(),R("span",ue,[a(y,{dense:"",flat:"",round:"",color:"primary",icon:"attachment",href:`/storage/${e.row.deletion_detail.supporting_document}`,target:"_blank"},null,8,["href"])])):(g(),R("span",ce,"N/A"))]}),_:2},1032,["props"])]),"body-cell-actions":l(e=>[a(c,{props:e},{default:l(()=>[a(y,{dense:"",flat:"",round:"",color:"primary",icon:"visibility",onClick:s=>o.$inertia.get(o.route("employee.show",e.row.id)),"aria-label":"Show user"},null,8,["onClick"]),a(y,{dense:"",flat:"",round:"",color:"negative",icon:"delete",onClick:s=>O(e.row),"aria-label":"Show user"},null,8,["onClick"]),a(y,{dense:"",flat:"",round:"",color:"green",icon:"restore",onClick:s=>Y(e.row),"aria-label":"Restore Employee"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","loading","filter"])]),_:1})]),_:1,__:[8]}))}});export{$e as default};
