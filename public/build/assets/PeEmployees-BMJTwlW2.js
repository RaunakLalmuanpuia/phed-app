import{Q as A,a as V}from"./QBreadcrumbs-Bb4f3Pfo.js";import{r as c,i as L,c as Q,o as k,w as l,b as s,f as t,t as u,m as p,p as I,q,Q as $,z as x,l as T,B as E,v as z}from"./app-BdlnoIGO.js";import{Q as C}from"./QSelect-BD5DIyHB.js";import{a as F,Q as M}from"./QLayout-DZlNtLYk.js";import{Q as y}from"./QTd-BaqEQ1mu.js";import{Q as O}from"./QTable-DRnAOOfr.js";import{_ as W}from"./BackendLayout-DOn8RhyN.js";import{u as G}from"./use-quasar-BhmNZs2G.js";import"./use-fullscreen-6TZGrrky.js";import"./touch-CMN1Nvv8.js";const H={class:"flex items-center justify-between q-pa-md bg-white"},J={class:"stitle"},K={class:"q-gutter-sm"},X={class:"row q-col-gutter-md"},Y={class:"row q-gutter-sm col-12 col-sm justify-end"},Z={class:"flex items-center gap-3"},ee={class:"text-body1"},ae={class:"text-caption text-grey"},te={class:"text-caption text-grey"},be=Object.assign({layout:W},{__name:"PeEmployees",props:["office","designations","educationQln","canCreate","canEdit","canDelete"],setup(m){const w=m,P=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"designation",label:"Designation",align:"left",field:"designation",sortable:!1},{name:"name_of_workplace",label:"Workplace",align:"left",field:"name_of_workplace",sortable:!1},{name:"remuneration",label:"Remuneration",align:"left",field:"remuneration",sortable:!0},{name:"date_of_next_increment",label:"Next Increment",align:"left",field:"date_of_next_increment",sortable:!0},{name:"actions",label:"Actions",align:"center"}],n=c({search:null,designation:null,education_qln:null});c("");const f=G(),S=c([]),_=c(!1),i=c({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),g=()=>{h({pagination:i.value,filter:n.value,search:n.value.search})};function h(o){const{page:a,rowsPerPage:e,sortBy:r,descending:oe}=o.pagination,D=o.filter,U=o.search;_.value=!0,axios.get(route("employees.json-index-pe",w.office),{params:{filter:D,page:a,rowsPerPage:e,search:U}}).then(d=>{console.log(d.data);const{list:b}=d.data,{data:v,per_page:N,current_page:R,total:j,to:le,from:ne}=b;S.value=v,i.value.page=R,i.value.rowsNumber=j,i.value.rowsPerPage=N}).catch(d=>{var b,v;f.notify({type:"negative",message:(v=(b=d==null?void 0:d.response)==null?void 0:b.data)==null?void 0:v.message})}).finally(()=>_.value=!1)}const B=()=>{f.loading.show(),axios.get(route("export.pe",w.office),{responseType:"blob"}).then(o=>{const a=window.URL.createObjectURL(new Blob([o.data])),e=document.createElement("a");e.href=a,e.setAttribute("download",w.office.name.replace(/\s+/g,"_")+"_provisional_employees.xlsx"),e.click()}).catch(o=>{var a,e;f.notify({type:"negative",message:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to download file"})}).finally(()=>{f.loading.hide()})};return L(()=>{h({pagination:i.value,filter:n.value,search:n.value.search})}),(o,a)=>(k(),Q(M,{class:"container",padding:""},{default:l(()=>[s("div",H,[s("div",null,[s("div",J,"Provisional Employee List: "+u(m.office.name),1),t(A,{class:"text-dark"},{default:l(()=>[t(V,{onClick:a[0]||(a[0]=e=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard"}),t(V,{label:"All Employees",to:o.route("mis.import")},null,8,["to"])]),_:1})]),s("div",K,[t(p,{label:"PE Summary",color:"primary",onClick:a[1]||(a[1]=e=>o.$inertia.get(o.route("summary.pe")))}),t(p,{label:"MR Summary",color:"primary",onClick:a[2]||(a[2]=e=>o.$inertia.get(o.route("summary.mr")))})])]),a[10]||(a[10]=s("br",null,null,-1)),t(I,{flat:"",bordered:""},{default:l(()=>[t(q,null,{default:l(()=>[a[9]||(a[9]=s("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Search Filter ",-1)),s("div",X,[t($,{dense:"",outlined:"",debounce:"300",modelValue:n.value.search,"onUpdate:modelValue":[a[3]||(a[3]=e=>n.value.search=e),g],placeholder:"Search",class:"col-12 col-sm-4",clearable:""},{append:l(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"]),t(C,{label:"Select Designation",class:"col-12 col-sm-4",modelValue:n.value.designation,"onUpdate:modelValue":[a[4]||(a[4]=e=>n.value.designation=e),g],options:m.designations,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"]),t(C,{label:"Select Education Qln.",class:"col-12 col-sm-4",modelValue:n.value.education_qln,"onUpdate:modelValue":[a[5]||(a[5]=e=>n.value.education_qln=e),g],options:m.educationQln,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"])])]),_:1,__:[9]}),t(T),t(q,{class:"row items-center justify-between q-gutter-md"},{default:l(()=>[s("div",Y,[t($,{dense:"",outlined:"",debounce:"300",modelValue:n.value.search,"onUpdate:modelValue":[a[6]||(a[6]=e=>n.value.search=e),g],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:l(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"]),t(p,{label:"Export",icon:"desktop_windows",color:"primary",onClick:B}),t(p,{label:"Add New PE Employee",icon:"add",color:"primary",onClick:a[7]||(a[7]=e=>o.$inertia.get(o.route("employee.create")))})])]),_:1}),t(O,{flat:"",ref:"tableRef",title:m.office.name,rows:S.value,columns:P,"row-key":"id",pagination:i.value,"onUpdate:pagination":a[8]||(a[8]=e=>i.value=e),loading:_.value,filter:n.value,"binary-state-sort":"","rows-per-page-options":[5,10,15,30,50],onRequest:h},{"body-cell-employee":l(e=>[t(y,{props:e},{default:l(()=>[s("div",Z,[t(z,null,{default:l(()=>[e.row.avatar?(k(),Q(F,{key:0,src:`/storage/${e.row.avatar}`},null,8,["src"])):(k(),Q(x,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),s("div",null,[s("div",ee,u(e.row.name),1),s("div",ae,u(e.row.mobile),1),s("div",te,u(e.row.date_of_birth),1)])])]),_:2},1032,["props"])]),"body-cell-remuneration":l(e=>[t(y,{props:e},{default:l(()=>{var r;return[E(u(((r=e.row.remuneration_detail)==null?void 0:r.round_total)!=null?`₹ ${e.row.remuneration_detail.round_total.toLocaleString()}`:"—"),1)]}),_:2},1032,["props"])]),"body-cell-date_of_next_increment":l(e=>[t(y,{props:e},{default:l(()=>{var r;return[E(u((r=e.row.remuneration_detail)!=null&&r.next_increment_date?new Date(e.row.remuneration_detail.next_increment_date).toLocaleDateString():"—"),1)]}),_:2},1032,["props"])]),"body-cell-actions":l(e=>[t(y,{props:e},{default:l(()=>[t(p,{dense:"",flat:"",round:"",color:"primary",icon:"visibility",onClick:r=>o.$inertia.get(o.route("employee.show",e.row.id)),"aria-label":"Show user"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["title","rows","pagination","loading","filter"])]),_:1})]),_:1,__:[10]}))}});export{be as default};
