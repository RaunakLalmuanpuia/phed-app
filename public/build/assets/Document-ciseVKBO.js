import{Q as Z,a as N}from"./QBreadcrumbs-DkqASnvn.js";import{Q as $}from"./QSelect-BBUPTZu7.js";import{r as u,x as ee,d as q,o as y,w as o,e as s,i as l,g as T,y as S,z as w,p as F,q as k,h as te,t as C,Q as le,D as ae,a0 as oe,f as O,F as se,v as ne,u as P,G as ie,$ as ue,N as re}from"./app-DUznSOmc.js";import{Q as R}from"./QTd-CRzo49di.js";import{Q as de}from"./QTable-CcvU9gtX.js";import{Q as me}from"./QFile-qGhNOsIj.js";import{Q as ce}from"./QLayout-Du6LMI_4.js";import{_ as fe,C as pe}from"./BackendLayout-C3ya82A2.js";import{u as ve}from"./use-quasar-Cr4Mn5yW.js";import"./QMarkupTable-DNRRxzx5.js";import"./use-fullscreen-C1mYzMDG.js";import"./touch-6qXbwtcZ.js";import"./QSlideTransition-DzeEXPqm.js";const ge={class:"flex items-center justify-between q-pa-md bg-white"},ye={class:"q-pa-md"},be={class:"row q-col-gutter-md"},we={class:"row q-gutter-sm col-12 col-sm justify-end"},ke={class:"row q-mb-sm items-center"},_e={class:"col-8 text-body1"},Qe={class:"row q-mb-sm items-center"},xe={class:"col-8 text-body1"},he={class:"text-subtitle2 q-mb-xs"},Fe=Object.assign({layout:fe},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(_){const d=u({offices:[],type:null}),I=[{label:"MR",value:"MR"},{label:"PE",value:"PE"}],D=u(""),m=ve(),Q=u([]),V=u(!1),b=u(!1),E=u(!1),c=u(null);function A(){if(!d.value.offices||d.value.offices.length===0){m.notify({type:"negative",message:"Please select an office"});return}E.value=!0,Q.value=[],setTimeout(()=>{c.value&&c.value.requestServerInteraction()})}function B(){v.value.page=1,c.value&&c.value.requestServerInteraction()}function j(){Q.value=[],E.value=!1}function G(a){(!a||a.length===0)&&j()}const r=ee({documents:[]}),v=u({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),M=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],x=u(null),U=u(null),z=a=>{U.value=a,x.value=a.id,r.documents=[],a.documents&&a.documents.length>0&&a.documents.forEach(e=>{r.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),b.value=!0},L=(a,e)=>{r.documents[a]={...r.documents[a],file:e}};function H(a){const{page:e,rowsPerPage:t,sortBy:n,descending:i}=a.pagination;V.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...d.value},page:e,rowsPerPage:t,search:D.value,sortBy:n,descending:i}}).then(g=>{const{list:f}=g.data,{data:p,per_page:h,current_page:X,total:Y}=f;Q.value=p,v.value.page=X,v.value.rowsNumber=Y,v.value.rowsPerPage=h}).catch(g=>{var f,p;m.notify({type:"negative",message:(p=(f=g==null?void 0:g.response)==null?void 0:f.data)==null?void 0:p.message})}).finally(()=>V.value=!1)}const J=()=>{if(!x.value)return;const a=new FormData;Object.entries(r.documents).forEach(([e,t])=>{t!=null&&t.file&&a.append(`documents[${e}]`,t.file)}),axios.post(route("document.update",x.value),a,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:t,message:n}=e;m.notify({type:"positive",message:n||"Employee saved successfully."}),c.value&&c.value.requestServerInteraction(),b.value=!1,r.documents=[],x.value=null}).catch(e=>{var t;if(e.response)if(e.response.status===422){const n=e.response.data.errors,i=n?Object.values(n)[0][0]:"Validation failed.";m.notify({type:"negative",message:i})}else m.notify({type:"negative",message:((t=e.response.data)==null?void 0:t.message)||"Something went wrong!"});else e.request?m.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):m.notify({type:"negative",message:"Unexpected error occurred."})})},K=a=>{window.open(a,"_blank")},W=()=>{window.history.back()};return(a,e)=>(y(),q(ce,{class:"container",padding:""},{default:o(()=>[s("div",ge,[s("div",null,[e[7]||(e[7]=s("div",{class:"stitle"},"Employee Documents",-1)),l(Z,{class:"text-dark"},{default:o(()=>[l(N,{onClick:e[0]||(e[0]=t=>a.$inertia.get(a.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),l(N,{class:"cursor-pointer",label:"Go Back",onClick:W})]),_:1})])]),e[12]||(e[12]=s("br",null,null,-1)),l(S,{flat:""},{default:o(()=>[l(w,null,{default:o(()=>[s("div",ye,[l(S,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[l(w,null,{default:o(()=>[e[8]||(e[8]=s("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),s("div",be,[l($,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:d.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>d.value.offices=t),G],options:_.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:j},null,8,["modelValue","options"]),l($,{label:"Select Employment Type",class:"col-12 col-sm-4",modelValue:d.value.type,"onUpdate:modelValue":[e[2]||(e[2]=t=>d.value.type=t),B],options:I,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue"])])]),_:1,__:[8]}),l(F),l(w,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[s("div",we,[_.canUpdateDocument?(y(),q(k,{key:0,label:"Get Employee",color:"primary",onClick:A})):T("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[13]||(e[13]=s("br",null,null,-1)),E.value?(y(),q(de,{key:0,ref_key:"empTable",ref:c,title:"Employees Document",rows:Q.value,columns:M,"row-key":"id",loading:V.value,pagination:v.value,"onUpdate:pagination":e[4]||(e[4]=t=>v.value=t),"rows-per-page-options":[5,10,20,50],onRequest:H},{"top-right":o(()=>[l(le,{dense:"",outlined:"",debounce:"800",modelValue:D.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>D.value=t),B],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[l(ae,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":o(t=>[l(R,{props:t},{default:o(()=>{var n;return[te(C((n=t.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(t=>[l(R,{props:t},{default:o(()=>[_.canUpdateDocument?(y(),q(k,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:n=>z(t.row),"aria-label":"Edit"},null,8,["onClick"])):T("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):T("",!0),l(oe,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t)},{default:o(()=>[l(S,{style:{"min-width":"400px"}},{default:o(()=>[l(w,null,{default:o(()=>e[9]||(e[9]=[s("div",{class:"text-h6"},"Update Document",-1)])),_:1,__:[9]}),l(w,{class:"q-gutter-md"},{default:o(()=>{var t,n;return[s("div",ke,[e[10]||(e[10]=s("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),s("div",_e,C((t=U.value)==null?void 0:t.name),1)]),s("div",Qe,[e[11]||(e[11]=s("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1)),s("div",xe,C((n=U.value)==null?void 0:n.employment_type),1)]),l(F),(y(!0),O(se,null,ne(_.documentTypes,(i,g)=>{var f,p;return y(),O("div",{class:"col-12 col-sm-6",key:i.id},[s("div",he,C(i.name),1),l(me,{filled:"","model-value":((f=P(r).documents[i.id])==null?void 0:f.file)||null,"onUpdate:modelValue":h=>L(i.id,h),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},ie({_:2},[(p=P(r).documents[i.id])!=null&&p.url?{name:"append",fn:o(()=>[l(k,{round:"",dense:"",flat:"",icon:"visibility",onClick:h=>K(P(r).documents[i.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))]}),_:1}),l(ue,{align:"right"},{default:o(()=>[re(l(k,{flat:"",label:"Cancel",onClick:e[5]||(e[5]=t=>!b.value)},null,512),[[pe]]),l(k,{color:"primary",label:"Update",onClick:J})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[12,13]}))}});export{Fe as default};
