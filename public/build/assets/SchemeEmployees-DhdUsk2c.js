import{a as B,Q as V}from"./QSelect-Tv460CEL.js";import{Q as L,a as C}from"./QBreadcrumbs-ClxWizdd.js";import{r as c,l as T,d as y,o as m,w as t,e as s,i as l,h as Q,f as z,F as M,v as O,q as x,y as W,z as P,p as G,Q as H,D as E,t as u,u as U,A as J}from"./app-DCB7a3Zp.js";import{a as K,Q as X}from"./QLayout-QaOrdhQa.js";import{Q as v}from"./QTd-DAtoToaX.js";import{Q as Y}from"./QTable-swFOIbKj.js";import{_ as Z}from"./BackendLayout-BYnaTZf5.js";import{u as ee}from"./use-quasar-DJ8LWnP7.js";import{u as ae}from"./useUtils-WQjwI6NZ.js";import"./QMarkupTable-DSqOVzZG.js";import"./use-fullscreen-CF5xWfa6.js";import"./touch-BIL16PTy.js";import"./QSlideTransition-B6vEB1ql.js";import"./date-CcRrjtfl.js";const le={class:"flex items-center justify-between q-pa-md bg-white"},te={class:"stitle"},oe={class:"q-gutter-sm"},se={class:"row q-col-gutter-md"},ne={class:"row q-gutter-sm col-12 col-sm justify-end"},ie={class:"flex items-center gap-3"},re={class:"text-body1"},de={class:"text-caption text-grey"},ce={class:"text-caption text-grey"},Ve=Object.assign({layout:Z},{__name:"SchemeEmployees",props:["offices","scheme","skills","educationQln"],setup(p){const{formatDate:S}=ae(),h=p,$=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"post_assigned",label:"Post/Work Assigned",align:"left",field:"post_assigned",sortable:!1},{name:"name_of_workplace",label:"Workplace",align:"left",field:"name_of_workplace",sortable:!1},{name:"scheme",label:"Scheme",align:"left",field:"scheme",sortable:!1},{name:"skill_at_present",label:"Skill At Present",align:"left",field:"skill_at_present",sortable:!0},{name:"date_of_engagement",label:"Initial Engagement",align:"left",field:"date_of_engagement",sortable:!0},{name:"actions",label:"Actions",align:"center"}],n=c({office:[],search:null,skill:null,education_qln:null});c("");const r=ee(),q=c([]),_=c(!1),i=c({sortBy:"desc",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),w=()=>{k({pagination:i.value,filter:n.value,search:n.value.search})};function k(o){const{page:a,rowsPerPage:e,sortBy:f,descending:me}=o.pagination,N=o.filter,R=o.search;_.value=!0,axios.get(route("employees.json-manager-scheme"),{params:{filter:N,page:a,rowsPerPage:e,search:R}}).then(d=>{console.log(d.data);const{list:g}=d.data,{data:b,per_page:D,current_page:F,total:I,to:ue,from:pe}=g;q.value=b,i.value.page=F,i.value.rowsNumber=I,i.value.rowsPerPage=D}).catch(d=>{var g,b;r.notify({type:"negative",message:(b=(g=d==null?void 0:d.response)==null?void 0:g.data)==null?void 0:b.message})}).finally(()=>_.value=!1)}const j=()=>{if(r.loading.show(),!h.scheme){r.notify({type:"negative",message:"No scheme found to export"}),r.loading.hide();return}axios.get(route("export.scheme",h.scheme.id),{responseType:"blob"}).then(o=>{const a=window.URL.createObjectURL(new Blob([o.data])),e=document.createElement("a");e.href=a,e.setAttribute("download",(h.scheme.name||"employees").replace(/\s+/g,"_")+"_scheme_employees.xlsx"),e.click()}).catch(o=>{var a,e;r.notify({type:"negative",message:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to download file"})}).finally(()=>{r.loading.hide()})};T(()=>{k({pagination:i.value,filter:n.value,search:n.value.search})});const A=()=>{window.history.back()};return(o,a)=>(m(),y(X,{class:"container",padding:""},{default:t(()=>[s("div",le,[s("div",null,[s("div",te,[a[6]||(a[6]=Q("Scheme Employee List: ")),(m(!0),z(M,null,O(p.offices,e=>(m(),y(B,{square:"",key:e.id,label:e.name},null,8,["label"]))),128))]),l(L,{class:"text-dark"},{default:t(()=>[l(C,{class:"cursor-pointer",onClick:a[0]||(a[0]=e=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard"}),l(C,{class:"cursor-pointer",label:"Go Back",onClick:A})]),_:1})]),s("div",oe,[l(x,{label:"MR Summary",color:"primary",onClick:a[1]||(a[1]=e=>o.$inertia.get(o.route("summary.mr")))})])]),a[8]||(a[8]=s("br",null,null,-1)),l(W,{flat:""},{default:t(()=>[l(P,null,{default:t(()=>[a[7]||(a[7]=s("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Search Filter ",-1)),s("div",se,[l(V,{label:"Select Present Skill",class:"col-12 col-sm-4",modelValue:n.value.skill,"onUpdate:modelValue":[a[2]||(a[2]=e=>n.value.skill=e),w],options:p.skills,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"]),l(V,{label:"Select Education Qln.",class:"col-12 col-sm-4",modelValue:n.value.education_qln,"onUpdate:modelValue":[a[3]||(a[3]=e=>n.value.education_qln=e),w],options:p.educationQln,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"])])]),_:1,__:[7]}),l(G),l(P,{class:"row items-center justify-between q-gutter-md"},{default:t(()=>[s("div",ne,[l(x,{label:"Export",icon:"desktop_windows",color:"primary",onClick:j}),l(H,{dense:"",outlined:"",debounce:"300",modelValue:n.value.search,"onUpdate:modelValue":[a[4]||(a[4]=e=>n.value.search=e),w],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:t(()=>[l(E,{name:"search"})]),_:1},8,["modelValue"])])]),_:1}),l(Y,{flat:"",ref:"tableRef",rows:q.value,columns:$,"row-key":"id",pagination:i.value,"onUpdate:pagination":a[5]||(a[5]=e=>i.value=e),loading:_.value,filter:n.value,"binary-state-sort":"","rows-per-page-options":[1,7,15,30,50],onRequest:k},{"body-cell-employee":t(e=>[l(v,{props:e},{default:t(()=>[s("div",ie,[l(J,null,{default:t(()=>[e.row.avatar?(m(),y(K,{key:0,src:`/storage/${e.row.avatar}`},null,8,["src"])):(m(),y(E,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),s("div",null,[s("div",re,u(e.row.name),1),s("div",de,u(e.row.mobile),1),s("div",ce,u(U(S)(e.row.date_of_birth)),1)])])]),_:2},1032,["props"])]),"body-cell-scheme":t(e=>[l(v,{props:e},{default:t(()=>[l(B,{color:"primary","text-color":"white",dense:""},{default:t(()=>{var f;return[Q(u((f=e.row.scheme)==null?void 0:f.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-date_of_engagement":t(e=>[l(v,{props:e},{default:t(()=>[Q(u(U(S)(e.row.date_of_engagement)),1)]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[l(v,{props:e},{default:t(()=>[l(x,{dense:"",flat:"",round:"",color:"primary",icon:"visibility",onClick:f=>o.$inertia.get(o.route("employee.show",e.row.id)),"aria-label":"Show user"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","loading","filter"])]),_:1})]),_:1,__:[8]}))}});export{Ve as default};
