import{Q as W,a as T}from"./QBreadcrumbs-C5gnExOV.js";import{Q as X}from"./QSelect-BB5BbCjb.js";import{r as i,x as Y,d as C,o as g,w as o,e as n,i as a,g as V,y as U,z as y,p as Z,q as w,h as ee,t as B,Q as te,D as ae,a0 as le,f as P,F as oe,v as se,u as E,G as ne,$ as ie,N as ue}from"./app-BGtWJzDz.js";import{Q as j}from"./QTd-B8hPB3ub.js";import{Q as re}from"./QTable-C2tji96x.js";import{Q as de}from"./QFile-D1vLAueY.js";import{Q as me}from"./QLayout-SRyaQRTJ.js";import{_ as ce,C as fe}from"./BackendLayout-DdVOodZe.js";import{u as pe}from"./use-quasar-BIvYES9O.js";/* empty css            */import"./QMarkupTable-BeL1vbSA.js";import"./use-fullscreen-Cm3t0b4O.js";import"./touch-QEkfa_ZD.js";import"./QSlideTransition-DZB5h8De.js";const ge={class:"flex items-center justify-between q-pa-md bg-white"},ve={class:"q-pa-md"},be={class:"row q-col-gutter-md"},ye={class:"row q-gutter-sm col-12 col-sm justify-end"},we={class:"text-subtitle2 q-mb-xs"},Pe=Object.assign({layout:ce},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(k){const v=i({offices:[]}),D=i(""),d=pe(),h=i([]),q=i(!1),b=i(!1),x=i(!1),m=i(null);function $(){if(!v.value.offices||v.value.offices.length===0){d.notify({type:"negative",message:"Please select an office"});return}x.value=!0,h.value=[],setTimeout(()=>{m.value&&m.value.requestServerInteraction()})}function F(){f.value.page=1,m.value&&m.value.requestServerInteraction()}function S(){h.value=[],x.value=!1}function N(l){(!l||l.length===0)&&S()}const u=Y({documents:[]}),f=i({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),O=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],Q=i(null),I=i(null),R=l=>{I.value=l,Q.value=l.id,u.documents=[],l.documents&&l.documents.length>0&&l.documents.forEach(e=>{u.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),b.value=!0},A=(l,e)=>{u.documents[l]={...u.documents[l],file:e}};function G(l){const{page:e,rowsPerPage:t,sortBy:s,descending:p}=l.pagination;q.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...v.value},page:e,rowsPerPage:t,search:D.value,sortBy:s,descending:p}}).then(r=>{const{list:c}=r.data,{data:_,per_page:J,current_page:K,total:M}=c;h.value=_,f.value.page=K,f.value.rowsNumber=M,f.value.rowsPerPage=J}).catch(r=>{var c,_;d.notify({type:"negative",message:(_=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:_.message})}).finally(()=>q.value=!1)}const z=()=>{if(!Q.value)return;const l=new FormData;Object.entries(u.documents).forEach(([e,t])=>{t!=null&&t.file&&l.append(`documents[${e}]`,t.file)}),axios.post(route("document.update",Q.value),l,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:t,message:s}=e;d.notify({type:"positive",message:s||"Employee saved successfully."}),m.value&&m.value.requestServerInteraction(),b.value=!1,u.documents=[],Q.value=null}).catch(e=>{var t;if(e.response)if(e.response.status===422){const s=e.response.data.errors,p=s?Object.values(s)[0][0]:"Validation failed.";d.notify({type:"negative",message:p})}else d.notify({type:"negative",message:((t=e.response.data)==null?void 0:t.message)||"Something went wrong!"});else e.request?d.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):d.notify({type:"negative",message:"Unexpected error occurred."})})},L=l=>{window.open(l,"_blank")},H=()=>{window.history.back()};return(l,e)=>(g(),C(me,{class:"container",padding:""},{default:o(()=>[n("div",ge,[n("div",null,[e[6]||(e[6]=n("div",{class:"stitle"},"Employee Documents",-1)),a(W,{class:"text-dark"},{default:o(()=>[a(T,{onClick:e[0]||(e[0]=t=>l.$inertia.get(l.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),a(T,{class:"cursor-pointer",label:"Go Back",onClick:H})]),_:1})])]),e[9]||(e[9]=n("br",null,null,-1)),a(U,{flat:""},{default:o(()=>[a(y,null,{default:o(()=>[n("div",ve,[a(U,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[a(y,null,{default:o(()=>[e[7]||(e[7]=n("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),n("div",be,[a(X,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:v.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>v.value.offices=t),N],options:k.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:S},null,8,["modelValue","options"])])]),_:1,__:[7]}),a(Z),a(y,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[n("div",ye,[k.canUpdateDocument?(g(),C(w,{key:0,label:"Get Employee",color:"primary",onClick:$})):V("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[10]||(e[10]=n("br",null,null,-1)),x.value?(g(),C(re,{key:0,ref_key:"empTable",ref:m,title:"Employees Document",rows:h.value,columns:O,"row-key":"id",loading:q.value,pagination:f.value,"onUpdate:pagination":e[3]||(e[3]=t=>f.value=t),"rows-per-page-options":[5,10,20,50],onRequest:G},{"top-right":o(()=>[a(te,{dense:"",outlined:"",debounce:"800",modelValue:D.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>D.value=t),F],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[a(ae,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":o(t=>[a(j,{props:t},{default:o(()=>{var s;return[ee(B((s=t.row.office)==null?void 0:s.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(t=>[a(j,{props:t},{default:o(()=>[k.canUpdateDocument?(g(),C(w,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:s=>R(t.row),"aria-label":"Edit"},null,8,["onClick"])):V("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):V("",!0),a(le,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t)},{default:o(()=>[a(U,{style:{"min-width":"400px"}},{default:o(()=>[a(y,null,{default:o(()=>e[8]||(e[8]=[n("div",{class:"text-h6"},"Update Document",-1)])),_:1,__:[8]}),a(y,{class:"q-gutter-md"},{default:o(()=>[(g(!0),P(oe,null,se(k.documentTypes,(t,s)=>{var p,r;return g(),P("div",{class:"col-12 col-sm-6",key:t.id},[n("div",we,B(t.name),1),a(de,{filled:"","model-value":((p=E(u).documents[t.id])==null?void 0:p.file)||null,"onUpdate:modelValue":c=>A(t.id,c),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},ne({_:2},[(r=E(u).documents[t.id])!=null&&r.url?{name:"append",fn:o(()=>[a(w,{round:"",dense:"",flat:"",icon:"visibility",onClick:c=>L(E(u).documents[t.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))]),_:1}),a(ie,{align:"right"},{default:o(()=>[ue(a(w,{flat:"",label:"Cancel",onClick:e[4]||(e[4]=t=>!b.value)},null,512),[[fe]]),a(w,{color:"primary",label:"Update",onClick:z})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[9,10]}))}});export{Pe as default};
