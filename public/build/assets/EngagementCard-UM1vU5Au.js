import{Q as me,a as F}from"./QBreadcrumbs-CHlcdP0M.js";import{Q as pe}from"./QSelect-DLlaUCaD.js";import{r as c,x as A,c as _,o as w,w as r,b as p,f as l,e as k,p as B,q as C,Q as u,l as ce,m as f,B as P,t as I,u as t,z as fe,a0 as T,A as h,$ as R,N as L}from"./app-BjfqQznS.js";import{Q as E}from"./QTd-CKJRkBOu.js";import{Q as ge}from"./QTable-C5cIvmPa.js";import{Q as z}from"./QForm-FoJXz9fu.js";import{Q as ve}from"./QLayout-CMnL2KG1.js";import{_ as be,C as H}from"./BackendLayout-x6HFbeb1.js";import{u as ye}from"./use-quasar-CZ-6PZuY.js";import{u as _e}from"./useUtils-DQJ3bmfR.js";/* empty css            */import"./use-fullscreen-DF3tRSuh.js";import"./touch-D1ixw8Fz.js";import"./date-qLJLS5_B.js";const we={class:"flex items-center justify-between q-pa-md bg-white"},Ve={class:"q-pa-md"},ke={class:"row q-col-gutter-md"},Ce={class:"row q-gutter-sm col-12 col-sm justify-end"},Ee={class:"row q-col-gutter-md"},De={class:"row q-col-gutter-md"},je=Object.assign({layout:be},{__name:"EngagementCard",props:["office","canGenerateEngagementCard"],setup($){const{formatDate:O}=_e(),m=c({offices:[],startYear:"",endYear:""}),N=c(""),g=c([]),i=ye(),Z=A({}),D=c([]),x=c(!1),G=c(!1),v=c(null);function M(){if(!m.value.offices||m.value.offices.length===0){i.notify({type:"negative",message:"Please select an office"});return}if(!m.value.startYear){i.notify({type:"negative",message:"Please select the Start Year"});return}if(!m.value.endYear){i.notify({type:"negative",message:"Please select the End Year"});return}G.value=!0,D.value=[],setTimeout(()=>{v.value&&v.value.requestServerInteraction()})}function J(){V.value.page=1,v.value&&v.value.requestServerInteraction()}function q(){D.value=[],G.value=!1}function K(o){(!o||o.length===0)&&q()}const V=c({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),W=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left"},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"card_no",label:"Card No.",field:"engagement_card.card_no",align:"center"},{name:"start_date",label:"Start Date",field:"engagement_card.start_date",align:"center"},{name:"end_date",label:"End Date",field:"engagement_card.end_date",align:"center"},{name:"actions",label:"Actions",align:"center"}];function X(o){const{page:e,rowsPerPage:a,sortBy:n,descending:b}=o.pagination;x.value=!0,axios.get(route("mis.json-engagement-card"),{params:{filter:{...m.value},page:e,rowsPerPage:a,search:N.value,sortBy:n,descending:b}}).then(y=>{const{list:Q}=y.data,{data:Y,per_page:se,current_page:ie,total:ue}=Q;D.value=Y,V.value.page=ie,V.value.rowsNumber=ue,V.value.rowsPerPage=se}).catch(y=>{var Q,Y;i.notify({type:"negative",message:(Y=(Q=y==null?void 0:y.response)==null?void 0:Q.data)==null?void 0:Y.message})}).finally(()=>x.value=!1)}const S=c(!1),j=c(null),d=A({employee_id:"",start_date:"",end_date:"",card_no:"",phed_file_no:"",letter_date:"",approval_dpar:"",approval_fin:""}),s=A({employee_ids:[],start_date:"",end_date:"",phed_file_no:"",letter_date:"",approval_dpar:"",approval_fin:""});function ee(o){j.value=o,d.reset(),S.value=!0}function ae(){d.employee_id=j.value,d.post(route("engagement-card.generate"),{onSuccess:()=>{var o;i.notify({type:"positive",message:"Engagement card generated."}),S.value=!1,(o=v.value)==null||o.requestServerInteraction()},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})}const U=c(!1);function le(o){if(!o.length)return i.notify({type:"negative",message:"Select employees first!"});s.reset(),s.employee_ids=o.map(e=>e.id),U.value=!0}function te(){s.post(route("engagement-card.bulk-generate"),{onSuccess:()=>{var o;i.notify({type:"positive",message:"Bulk engagement cards generated."}),U.value=!1,(o=v.value)==null||o.requestServerInteraction(),g.value=[]},onError:o=>{Object.values(o).forEach(e=>{i.notify({type:"negative",message:e,position:"bottom"})})}})}function oe(o){i.dialog({title:"Confirm Deletion",message:"Are you sure you want to delete this Engagement Card?",ok:{label:"Yes",color:"primary"},cancel:{label:"No",color:"red"}}).onOk(()=>{Z.delete(route("engagement-card.destroy",o),{onSuccess:()=>{var e;i.notify({type:"positive",message:"Engagement card deleted."}),(e=v.value)==null||e.requestServerInteraction()},onError:e=>{Object.values(e).forEach(a=>{i.notify({type:"negative",message:a,position:"bottom"})})}})}).onCancel(()=>{i.notify({type:"info",message:"Deletion cancelled.",color:"negative"})})}const re=async o=>{try{const e=await axios.get(route("engagement-card.download",o),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data],{type:"application/pdf"})),n=document.createElement("a");n.href=a,n.setAttribute("download",`EngagementCard_${o.card_no}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch(e){i.notify({type:"negative",message:e})}},ne=async()=>{var o;if(g.value.length===0)return i.notify({type:"negative",message:"Select employees first!"});try{const e=g.value.map(y=>y.id),a=await axios.post(route("engagement-card.bulk-download"),{employee_ids:e,start_date:`${m.value.startYear}-03-01`,end_date:`${m.value.endYear}-02-28`},{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data],{type:"application/zip"})),b=document.createElement("a");b.href=n,b.setAttribute("download",`EngagementCards_${Date.now()}.zip`),document.body.appendChild(b),b.click(),b.remove(),(o=v.value)==null||o.requestServerInteraction(),g.value=[],i.notify({type:"positive",message:"ZIP downloaded successfully."})}catch(e){i.notify({type:"negative",message:"No Engagement card to Download"}),console.error(e)}},de=()=>{window.history.back()};return(o,e)=>(w(),_(ve,{class:"container",padding:""},{default:r(()=>[p("div",we,[p("div",null,[e[22]||(e[22]=p("div",{class:"stitle"},"Engagement Card",-1)),l(me,{class:"text-dark"},{default:r(()=>[l(F,{onClick:e[0]||(e[0]=a=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),l(F,{class:"cursor-pointer",label:"Go Back",onClick:de})]),_:1})])]),e[26]||(e[26]=p("br",null,null,-1)),l(B,{flat:""},{default:r(()=>[l(C,null,{default:r(()=>[p("div",Ve,[l(B,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:r(()=>[l(C,null,{default:r(()=>[e[23]||(e[23]=p("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),p("div",ke,[l(pe,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:m.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=a=>m.value.offices=a),K],options:$.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:q},null,8,["modelValue","options"]),l(u,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Start Year",modelValue:m.value.startYear,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.startYear=a),mask:"####",placeholder:"YYYY",onClear:q},null,8,["modelValue"]),l(u,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"End Year",modelValue:m.value.endYear,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value.endYear=a),mask:"####",placeholder:"YYYY",onClear:q},null,8,["modelValue"])])]),_:1,__:[23]}),l(ce),l(C,{class:"row items-center justify-between q-gutter-md"},{default:r(()=>[p("div",Ce,[$.canGenerateEngagementCard?(w(),_(f,{key:0,label:"Get Employee",color:"primary",onClick:M})):k("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[27]||(e[27]=p("br",null,null,-1)),G.value?(w(),_(ge,{key:0,ref_key:"empTable",ref:v,title:"Employees Engagement Cards",rows:D.value,columns:W,"row-key":"id",loading:x.value,pagination:V.value,"onUpdate:pagination":e[6]||(e[6]=a=>V.value=a),"rows-per-page-options":[5,10,20,50],onRequest:X,selection:"multiple",selected:g.value,"onUpdate:selected":e[7]||(e[7]=a=>g.value=a)},{"top-right":r(()=>[g.value.length>0?(w(),_(f,{key:0,class:"q-mr-sm",icon:"picture_as_pdf",label:"Generate Cards",color:"primary",onClick:e[4]||(e[4]=a=>le(g.value))})):k("",!0),g.value.length>0?(w(),_(f,{key:1,class:"q-mr-sm",icon:"download",label:"Download ZIP",color:"primary",onClick:ne})):k("",!0),l(u,{dense:"",outlined:"",debounce:"800",modelValue:N.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>N.value=a),J],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:r(()=>[l(fe,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":r(a=>[l(E,{props:a},{default:r(()=>{var n;return[P(I((n=a.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-card_no":r(a=>[l(E,{props:a},{default:r(()=>{var n;return[P(I(((n=a.row.engagement_card[0])==null?void 0:n.card_no)??"Not Generated"),1)]}),_:2},1032,["props"])]),"body-cell-start_date":r(a=>[l(E,{props:a},{default:r(()=>{var n;return[P(I(t(O)((n=a.row.engagement_card[0])==null?void 0:n.start_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-end_date":r(a=>[l(E,{props:a},{default:r(()=>{var n;return[P(I(t(O)((n=a.row.engagement_card[0])==null?void 0:n.end_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-actions":r(a=>[l(E,{props:a},{default:r(()=>[l(f,{dense:"",flat:"",round:"",color:"primary",icon:"picture_as_pdf",onClick:n=>ee(a.row.id),"aria-label":"Generate Card"},null,8,["onClick"]),a.row.engagement_card[0]?(w(),_(f,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"download",onClick:n=>re(a.row.engagement_card[0]),"aria-label":"Generate Card"},null,8,["onClick"])):k("",!0),a.row.engagement_card[0]?(w(),_(f,{key:1,dense:"",flat:"",round:"",color:"red",icon:"delete",onClick:n=>oe(a.row.engagement_card[0].id),"aria-label":"Delete Card"},null,8,["onClick"])):k("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):k("",!0),l(T,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=a=>S.value=a)},{default:r(()=>[l(B,null,{default:r(()=>[l(C,{class:"q-pa-md"},{default:r(()=>[e[24]||(e[24]=p("div",{class:"text-h6 q-mb-md"},"Generate Engagement Card",-1)),l(z,{onSubmit:h(ae,["prevent"])},{default:r(()=>[p("div",Ee,[l(u,{filled:"",modelValue:t(d).start_date,"onUpdate:modelValue":e[8]||(e[8]=a=>t(d).start_date=a),label:"Start Date",type:"date",class:"col-6",error:t(d).errors.start_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(d).end_date,"onUpdate:modelValue":e[9]||(e[9]=a=>t(d).end_date=a),label:"End Date",type:"date",class:"col-6",error:t(d).errors.end_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(d).phed_file_no,"onUpdate:modelValue":e[10]||(e[10]=a=>t(d).phed_file_no=a),label:"PHED File Number",class:"col-8",error:t(d).errors.phed_file_no},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(d).letter_date,"onUpdate:modelValue":e[11]||(e[11]=a=>t(d).letter_date=a),label:"Letter Date",type:"date",class:"col-4",error:t(d).errors.letter_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(d).approval_dpar,"onUpdate:modelValue":e[12]||(e[12]=a=>t(d).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:t(d).errors.approval_dpar},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(d).approval_fin,"onUpdate:modelValue":e[13]||(e[13]=a=>t(d).approval_fin=a),label:"Approval Finance",class:"col-12",error:t(d).errors.approval_fin},null,8,["modelValue","error"])]),l(R,{align:"right"},{default:r(()=>[L(l(f,{flat:"",label:"Cancel",color:"negative"},null,512),[[H]]),l(f,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[24]})]),_:1})]),_:1},8,["modelValue"]),l(T,{modelValue:U.value,"onUpdate:modelValue":e[21]||(e[21]=a=>U.value=a)},{default:r(()=>[l(B,null,{default:r(()=>[l(C,{class:"q-pa-md"},{default:r(()=>[e[25]||(e[25]=p("div",{class:"text-h6 q-mb-md"},"Generate Bulk Cards",-1)),l(z,{onSubmit:h(te,["prevent"])},{default:r(()=>[p("div",De,[l(u,{filled:"",modelValue:t(s).start_date,"onUpdate:modelValue":e[15]||(e[15]=a=>t(s).start_date=a),label:"Start Date",type:"date",class:"col-6",error:t(s).errors.start_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(s).end_date,"onUpdate:modelValue":e[16]||(e[16]=a=>t(s).end_date=a),label:"End Date",type:"date",class:"col-6",error:t(s).errors.end_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(s).phed_file_no,"onUpdate:modelValue":e[17]||(e[17]=a=>t(s).phed_file_no=a),label:"PHED File Number",class:"col-8",error:t(s).errors.phed_file_no},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(s).letter_date,"onUpdate:modelValue":e[18]||(e[18]=a=>t(s).letter_date=a),label:"Letter Date",type:"date",class:"col-4",error:t(s).errors.letter_date},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(s).approval_dpar,"onUpdate:modelValue":e[19]||(e[19]=a=>t(s).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:t(s).errors.approval_dpar},null,8,["modelValue","error"]),l(u,{filled:"",modelValue:t(s).approval_fin,"onUpdate:modelValue":e[20]||(e[20]=a=>t(s).approval_fin=a),label:"Approval Finance",class:"col-12",error:t(s).errors.approval_fin},null,8,["modelValue","error"])]),l(R,{align:"right"},{default:r(()=>[L(l(f,{flat:"",label:"Cancel",color:"negative"},null,512),[[H]]),l(f,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[25]})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[26,27]}))}});export{je as default};
