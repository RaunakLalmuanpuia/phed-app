import{Q as se,a as h}from"./QBreadcrumbs-T16Zjz_z.js";import{Q as de}from"./QSelect-BDAnrNHM.js";import{r as f,x as F,c as w,o as V,w as r,b as m,f as l,e as Y,p as P,q as C,Q as p,l as ie,m as g,B,t as I,z as ue,a0 as T,A as j,u as t,$ as O,N as R}from"./app-D8z8bb9q.js";import{Q as k}from"./QTd-Ct-1ixCx.js";import{Q as me}from"./QTable-DFTT8byY.js";import{Q as L}from"./QForm-C7QLhB6G.js";import{Q as pe}from"./QLayout-C7VlCBcR.js";import{_ as fe,C as z}from"./BackendLayout-CQc8lP7C.js";import{u as ce}from"./use-quasar-C6engRC4.js";import"./use-fullscreen-CxhTutMd.js";import"./touch-DRp_7L6A.js";const ge={class:"flex items-center justify-between q-pa-md bg-white"},ve={class:"q-pa-md"},be={class:"row q-col-gutter-md"},ye={class:"row q-gutter-sm col-12 col-sm justify-end"},_e={class:"row q-col-gutter-md"},we={class:"row q-col-gutter-md"},Be=Object.assign({layout:fe},{__name:"EngagementCard",props:["office","canGenerateEngagementCard"],setup(A){const i=f({offices:[],startYear:"",endYear:""}),N=f(""),c=f([]),u=ce(),E=f([]),x=f(!1),G=f(!1),v=f(null);function H(){if(!i.value.offices||i.value.offices.length===0){u.notify({type:"negative",message:"Please select an office"});return}if(!i.value.startYear){u.notify({type:"negative",message:"Please select the Start Year"});return}if(!i.value.endYear){u.notify({type:"negative",message:"Please select the End Year"});return}G.value=!0,E.value=[],setTimeout(()=>{v.value&&v.value.requestServerInteraction()})}function Z(){_.value.page=1,v.value&&v.value.requestServerInteraction()}function q(){E.value=[],G.value=!1}function M(o){(!o||o.length===0)&&q()}const _=f({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),J=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left"},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"card_no",label:"Card No.",field:"engagement_card.card_no",align:"center"},{name:"start_date",label:"Start Date",field:"engagement_card.start_date",align:"center"},{name:"end_date",label:"End Date",field:"engagement_card.end_date",align:"center"},{name:"actions",label:"Actions",align:"center"}];function K(o){const{page:e,rowsPerPage:a,sortBy:n,descending:b}=o.pagination;x.value=!0,axios.get(route("mis.json-engagement-card"),{params:{filter:{...i.value},page:e,rowsPerPage:a,search:N.value,sortBy:n,descending:b}}).then(y=>{const{list:S}=y.data,{data:U,per_page:oe,current_page:re,total:ne}=S;E.value=U,_.value.page=re,_.value.rowsNumber=ne,_.value.rowsPerPage=oe}).catch(y=>{var S,U;u.notify({type:"negative",message:(U=(S=y==null?void 0:y.response)==null?void 0:S.data)==null?void 0:U.message})}).finally(()=>x.value=!1)}const D=f(!1),$=f(null),s=F({employee_id:"",start_date:"",end_date:"",card_no:"",phed_file_no:"",approval_dpar:"",approval_fin:""}),d=F({employee_ids:[],start_date:"",end_date:"",phed_file_no:"",approval_dpar:"",approval_fin:""});function W(o){$.value=o,s.reset(),D.value=!0}function X(){s.employee_id=$.value,s.post(route("engagement-card.generate"),{onSuccess:()=>{var o;u.notify({type:"positive",message:"Engagement card generated."}),D.value=!1,(o=v.value)==null||o.requestServerInteraction()},onError:o=>{Object.values(o).forEach(e=>{u.notify({type:"negative",message:e,position:"bottom"})})}})}const Q=f(!1);function ee(o){if(!o.length)return u.notify({type:"negative",message:"Select employees first!"});d.reset(),d.employee_ids=o.map(e=>e.id),Q.value=!0}function ae(){d.post(route("engagement-card.bulk-generate"),{onSuccess:()=>{var o;u.notify({type:"positive",message:"Bulk engagement cards generated."}),Q.value=!1,(o=v.value)==null||o.requestServerInteraction(),c.value=[]},onError:o=>{Object.values(o).forEach(e=>{u.notify({type:"negative",message:e,position:"bottom"})})}})}const le=async o=>{try{const e=await axios.get(route("engagement-card.download",o),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data],{type:"application/pdf"})),n=document.createElement("a");n.href=a,n.setAttribute("download",`EngagementCard_${o.card_no}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch(e){u.notify({type:"negative",message:e})}},te=async()=>{var o;if(c.value.length===0)return u.notify({type:"negative",message:"Select employees first!"});try{const e=c.value.map(y=>y.id),a=await axios.post(route("engagement-card.bulk-download"),{employee_ids:e,start_date:`${i.value.startYear}-03-01`,end_date:`${i.value.endYear}-02-28`},{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data],{type:"application/zip"})),b=document.createElement("a");b.href=n,b.setAttribute("download",`EngagementCards_${Date.now()}.zip`),document.body.appendChild(b),b.click(),b.remove(),(o=v.value)==null||o.requestServerInteraction(),c.value=[],u.notify({type:"positive",message:"ZIP downloaded successfully."})}catch(e){u.notify({type:"negative",message:"No Engagement card to Download"}),console.error(e)}};return(o,e)=>(V(),w(pe,{class:"container",padding:""},{default:r(()=>[m("div",ge,[m("div",null,[e[20]||(e[20]=m("div",{class:"stitle"},"Engagement Card",-1)),l(se,{class:"text-dark"},{default:r(()=>[l(h,{onClick:e[0]||(e[0]=a=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard"}),l(h,{label:"Engagement Card",to:o.route("mis.engagement-card")},null,8,["to"])]),_:1})])]),e[24]||(e[24]=m("br",null,null,-1)),l(P,{flat:""},{default:r(()=>[l(C,null,{default:r(()=>[m("div",ve,[l(P,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:r(()=>[l(C,null,{default:r(()=>[e[21]||(e[21]=m("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),m("div",be,[l(de,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:i.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=a=>i.value.offices=a),M],options:A.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:q},null,8,["modelValue","options"]),l(p,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Start Year",modelValue:i.value.startYear,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.startYear=a),mask:"####",placeholder:"YYYY",onClear:q},null,8,["modelValue"]),l(p,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"End Year",modelValue:i.value.endYear,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.endYear=a),mask:"####",placeholder:"YYYY",onClear:q},null,8,["modelValue"])])]),_:1,__:[21]}),l(ie),l(C,{class:"row items-center justify-between q-gutter-md"},{default:r(()=>[m("div",ye,[A.canGenerateEngagementCard?(V(),w(g,{key:0,label:"Get Employee",color:"primary",onClick:H})):Y("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[25]||(e[25]=m("br",null,null,-1)),G.value?(V(),w(me,{key:0,ref_key:"empTable",ref:v,title:"Employees Engagement Cards",rows:E.value,columns:J,"row-key":"id",loading:x.value,pagination:_.value,"onUpdate:pagination":e[6]||(e[6]=a=>_.value=a),"rows-per-page-options":[5,10,20,50],onRequest:K,selection:"multiple",selected:c.value,"onUpdate:selected":e[7]||(e[7]=a=>c.value=a)},{"top-right":r(()=>[c.value.length>0?(V(),w(g,{key:0,class:"q-mr-sm",icon:"picture_as_pdf",label:"Generate Cards",color:"primary",onClick:e[4]||(e[4]=a=>ee(c.value))})):Y("",!0),c.value.length>0?(V(),w(g,{key:1,class:"q-mr-sm",icon:"download",label:"Download ZIP",color:"primary",onClick:te})):Y("",!0),l(p,{dense:"",outlined:"",debounce:"800",modelValue:N.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>N.value=a),Z],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:r(()=>[l(ue,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":r(a=>[l(k,{props:a},{default:r(()=>{var n;return[B(I((n=a.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-card_no":r(a=>[l(k,{props:a},{default:r(()=>{var n;return[B(I(((n=a.row.engagement_card[0])==null?void 0:n.card_no)??"Not Generated"),1)]}),_:2},1032,["props"])]),"body-cell-start_date":r(a=>[l(k,{props:a},{default:r(()=>{var n;return[B(I(((n=a.row.engagement_card[0])==null?void 0:n.start_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-end_date":r(a=>[l(k,{props:a},{default:r(()=>{var n;return[B(I(((n=a.row.engagement_card[0])==null?void 0:n.end_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-actions":r(a=>[l(k,{props:a},{default:r(()=>[l(g,{dense:"",flat:"",round:"",color:"primary",icon:"picture_as_pdf",onClick:n=>W(a.row.id),"aria-label":"Generate Card"},null,8,["onClick"]),l(g,{dense:"",flat:"",round:"",color:"primary",icon:"download",onClick:n=>le(a.row.engagement_card[0]),"aria-label":"Generate Card"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):Y("",!0),l(T,{modelValue:D.value,"onUpdate:modelValue":e[13]||(e[13]=a=>D.value=a)},{default:r(()=>[l(P,null,{default:r(()=>[l(C,{class:"q-pa-md"},{default:r(()=>[e[22]||(e[22]=m("div",{class:"text-h6 q-mb-md"},"Generate Engagement Card",-1)),l(L,{onSubmit:j(X,["prevent"])},{default:r(()=>[m("div",_e,[l(p,{filled:"",modelValue:t(s).start_date,"onUpdate:modelValue":e[8]||(e[8]=a=>t(s).start_date=a),label:"Start Date",type:"date",class:"col-6",error:t(s).errors.start_date},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(s).end_date,"onUpdate:modelValue":e[9]||(e[9]=a=>t(s).end_date=a),label:"End Date",type:"date",class:"col-6",error:t(s).errors.end_date},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(s).phed_file_no,"onUpdate:modelValue":e[10]||(e[10]=a=>t(s).phed_file_no=a),label:"PHED File Number",class:"col-12",error:t(s).errors.phed_file_no},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(s).approval_dpar,"onUpdate:modelValue":e[11]||(e[11]=a=>t(s).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:t(s).errors.approval_dpar},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(s).approval_fin,"onUpdate:modelValue":e[12]||(e[12]=a=>t(s).approval_fin=a),label:"Approval Finance",class:"col-12",error:t(s).errors.approval_fin},null,8,["modelValue","error"])]),l(O,{align:"right"},{default:r(()=>[R(l(g,{flat:"",label:"Cancel",color:"negative"},null,512),[[z]]),l(g,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[22]})]),_:1})]),_:1},8,["modelValue"]),l(T,{modelValue:Q.value,"onUpdate:modelValue":e[19]||(e[19]=a=>Q.value=a)},{default:r(()=>[l(P,null,{default:r(()=>[l(C,{class:"q-pa-md"},{default:r(()=>[e[23]||(e[23]=m("div",{class:"text-h6 q-mb-md"},"Generate Bulk Cards",-1)),l(L,{onSubmit:j(ae,["prevent"])},{default:r(()=>[m("div",we,[l(p,{filled:"",modelValue:t(d).start_date,"onUpdate:modelValue":e[14]||(e[14]=a=>t(d).start_date=a),label:"Start Date",type:"date",class:"col-6",error:t(d).errors.start_date},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(d).end_date,"onUpdate:modelValue":e[15]||(e[15]=a=>t(d).end_date=a),label:"End Date",type:"date",class:"col-6",error:t(d).errors.end_date},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(d).phed_file_no,"onUpdate:modelValue":e[16]||(e[16]=a=>t(d).phed_file_no=a),label:"PHED File Number",class:"col-12",error:t(d).errors.phed_file_no},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(d).approval_dpar,"onUpdate:modelValue":e[17]||(e[17]=a=>t(d).approval_dpar=a),label:"Approval DP&AR",class:"col-12",error:t(d).errors.approval_dpar},null,8,["modelValue","error"]),l(p,{filled:"",modelValue:t(d).approval_fin,"onUpdate:modelValue":e[18]||(e[18]=a=>t(d).approval_fin=a),label:"Approval Finance",class:"col-12",error:t(d).errors.approval_fin},null,8,["modelValue","error"])]),l(O,{align:"right"},{default:r(()=>[R(l(g,{flat:"",label:"Cancel",color:"negative"},null,512),[[z]]),l(g,{flat:"",label:"Generate",color:"primary",type:"submit"})]),_:1})]),_:1})]),_:1,__:[23]})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[24,25]}))}});export{Be as default};
