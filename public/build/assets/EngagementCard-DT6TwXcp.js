import{a as A}from"./QSelect-bZwIqEGU.js";import{Q as Z,a as x}from"./QBreadcrumbs-35maSnu2.js";import{r as d,d as b,o as m,w as l,e as s,i as n,g as C,h as v,f as H,F as J,v as K,y as N,z as q,Q as B,p as M,q as P,t as Y,u as T,D as W}from"./app-5B2tuQbj.js";import{Q as y}from"./QTd-R5Y4xcXM.js";import{Q as X}from"./QTable-BM7nbNCq.js";import{Q as ee}from"./QLayout-CBx8Tjsx.js";import{_ as ae}from"./BackendLayout-CDXNfuFE.js";import{u as te}from"./use-quasar-DbaGU1B6.js";import{u as le}from"./useUtils-ibq4SzKr.js";import"./format-C7wczd8J.js";import"./QMarkupTable-X4LoNq82.js";import"./use-fullscreen-BRvL7mIY.js";import"./touch-BnuHVUl7.js";import"./QSlideTransition-BaLaD6tB.js";import"./date-DnpAhAxn.js";const ne={class:"flex items-center justify-between q-pa-md bg-white"},oe={class:"stitle"},re={class:"q-pa-md"},se={class:"row q-col-gutter-md"},de={class:"row q-gutter-sm col-12 col-sm justify-end"},he=Object.assign({layout:ae},{__name:"EngagementCard",props:["offices","canDownloadEngagementCard"],setup(V){const{formatDate:D}=le(),r=d({startYear:"",endYear:""}),h=d(""),p=d([]),i=te(),w=d([]),E=d(!1),Q=d(!1),g=d(null);function U(){if(!r.value.startYear){i.notify({type:"negative",message:"Please select the Start Year"});return}if(!r.value.endYear){i.notify({type:"negative",message:"Please select the End Year"});return}Q.value=!0,w.value=[],setTimeout(()=>{g.value&&g.value.requestServerInteraction()})}function $(){f.value.page=1,g.value&&g.value.requestServerInteraction()}function S(){w.value=[],Q.value=!1}const f=d({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),j=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left"},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"card_no",label:"Card No.",field:"engagement_card.card_no",align:"center"},{name:"start_date",label:"Start Date",field:"engagement_card.start_date",align:"center"},{name:"end_date",label:"End Date",field:"engagement_card.end_date",align:"center"},{name:"actions",label:"Actions",align:"center"}];function I(o){const{page:a,rowsPerPage:e,sortBy:t,descending:c}=o.pagination;E.value=!0,axios.get(route("mis.manager-json-engagement-card"),{params:{filter:{...r.value},page:a,rowsPerPage:e,search:h.value,sortBy:t,descending:c}}).then(u=>{const{list:_}=u.data,{data:k,per_page:G,current_page:O,total:z}=_;w.value=k,f.value.page=O,f.value.rowsNumber=z,f.value.rowsPerPage=G}).catch(u=>{var _,k;i.notify({type:"negative",message:(k=(_=u==null?void 0:u.response)==null?void 0:_.data)==null?void 0:k.message})}).finally(()=>E.value=!1)}const R=async o=>{try{const a=await axios.get(route("engagement-card.download",o),{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([a.data],{type:"application/pdf"})),t=document.createElement("a");t.href=e,t.setAttribute("download",`EngagementCard_${o.card_no}.pdf`),document.body.appendChild(t),t.click(),t.remove()}catch(a){i.notify({type:"negative",message:a})}},L=async()=>{var o;if(p.value.length===0)return i.notify({type:"negative",message:"Select employees first!"});try{const a=p.value.map(u=>u.id),e=await axios.post(route("engagement-card.bulk-download"),{employee_ids:a,start_date:`${r.value.startYear}-03-01`,end_date:`${r.value.endYear}-02-28`},{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data],{type:"application/zip"})),c=document.createElement("a");c.href=t,c.setAttribute("download",`EngagementCards_${Date.now()}.zip`),document.body.appendChild(c),c.click(),c.remove(),(o=g.value)==null||o.requestServerInteraction(),p.value=[],i.notify({type:"positive",message:"ZIP downloaded successfully."})}catch(a){i.notify({type:"negative",message:"No Engagement card to Download"}),console.error(a)}},F=()=>{window.history.back()};return(o,a)=>(m(),b(ee,{class:"container",padding:""},{default:l(()=>[s("div",ne,[s("div",null,[s("div",oe,[a[6]||(a[6]=v("Engagement Card :")),(m(!0),H(J,null,K(V.offices,e=>(m(),b(A,{square:"",key:e.value,label:e.label},null,8,["label"]))),128))]),n(Z,{class:"text-dark"},{default:l(()=>[n(x,{onClick:a[0]||(a[0]=e=>o.$inertia.get(o.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),n(x,{class:"cursor-pointer",label:"Go Back",onClick:F})]),_:1})])]),a[8]||(a[8]=s("br",null,null,-1)),n(N,{flat:""},{default:l(()=>[n(q,null,{default:l(()=>[s("div",re,[n(N,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:l(()=>[n(q,null,{default:l(()=>[a[7]||(a[7]=s("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Fiscal Year Filter ",-1)),s("div",se,[n(B,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Start Year",modelValue:r.value.startYear,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.startYear=e),mask:"####",placeholder:"YYYY",onClear:S},null,8,["modelValue"]),n(B,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"End Year",modelValue:r.value.endYear,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.endYear=e),mask:"####",placeholder:"YYYY",onClear:S},null,8,["modelValue"])])]),_:1,__:[7]}),n(M),n(q,{class:"row items-center justify-between q-gutter-md"},{default:l(()=>[s("div",de,[V.canDownloadEngagementCard?(m(),b(P,{key:0,label:"Get Employee",color:"primary",onClick:U})):C("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),a[9]||(a[9]=s("br",null,null,-1)),Q.value?(m(),b(X,{key:0,ref_key:"empTable",ref:g,title:"Employees Engagement Cards",rows:w.value,columns:j,"row-key":"id",loading:E.value,pagination:f.value,"onUpdate:pagination":a[4]||(a[4]=e=>f.value=e),"rows-per-page-options":[5,10,20,50],onRequest:I,selection:"multiple",selected:p.value,"onUpdate:selected":a[5]||(a[5]=e=>p.value=e)},{"top-right":l(()=>[p.value.length>0?(m(),b(P,{key:0,class:"q-mr-sm",icon:"download",label:"Download ZIP",color:"primary",onClick:L})):C("",!0),n(B,{dense:"",outlined:"",debounce:"800",modelValue:h.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>h.value=e),$],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:l(()=>[n(W,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":l(e=>[n(y,{props:e},{default:l(()=>{var t;return[v(Y((t=e.row.office)==null?void 0:t.name),1)]}),_:2},1032,["props"])]),"body-cell-card_no":l(e=>[n(y,{props:e},{default:l(()=>{var t;return[v(Y(((t=e.row.engagement_card[0])==null?void 0:t.card_no)??"Not Generated"),1)]}),_:2},1032,["props"])]),"body-cell-start_date":l(e=>[n(y,{props:e},{default:l(()=>{var t;return[v(Y(T(D)((t=e.row.engagement_card[0])==null?void 0:t.start_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-end_date":l(e=>[n(y,{props:e},{default:l(()=>{var t;return[v(Y(T(D)((t=e.row.engagement_card[0])==null?void 0:t.end_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-actions":l(e=>[n(y,{props:e},{default:l(()=>[e.row.engagement_card[0]?(m(),b(P,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"download",onClick:t=>R(e.row.engagement_card[0]),"aria-label":"Generate Card"},null,8,["onClick"])):C("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])):C("",!0)]),_:1,__:[8,9]}))}});export{he as default};
