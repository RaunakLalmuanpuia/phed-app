import{Q as ge,a as Y}from"./QBreadcrumbs-ClxWizdd.js";import{Q as A}from"./QSelect-Tv460CEL.js";import{r as d,x as ye,d as _,o as r,w as o,e as t,i as a,g as f,y as M,z as D,p as H,q as x,h as X,t as u,A as be,D as Z,u as E,Q as _e,a0 as xe,f as q,F as we,v as he,G as ke,$ as qe,N as Qe}from"./app-DCB7a3Zp.js";import{a as ee,Q as Ce}from"./QLayout-QaOrdhQa.js";import{Q as O}from"./QTd-DAtoToaX.js";import{Q as Pe}from"./QTable-swFOIbKj.js";import{Q as De}from"./QFile-w2AyuhWl.js";import{_ as Ee,C as Ve}from"./BackendLayout-BYnaTZf5.js";import{u as Ue}from"./use-quasar-DJ8LWnP7.js";import{u as Te}from"./useUtils-WQjwI6NZ.js";import"./QMarkupTable-DSqOVzZG.js";import"./use-fullscreen-CF5xWfa6.js";import"./touch-BIL16PTy.js";import"./QSlideTransition-B6vEB1ql.js";import"./date-CcRrjtfl.js";const Se={class:"flex items-center justify-between q-pa-md bg-white"},Be={class:"q-pa-md"},Fe={class:"row q-col-gutter-md"},Re={class:"row q-gutter-sm col-12 col-sm justify-end"},$e={class:"flex items-center gap-3"},je={class:"text-body1"},Ie={class:"text-caption text-grey"},Ne={class:"text-caption text-grey"},Ae={class:"grid grid-cols-2 gap-4 items-start relative"},Me={class:"row q-mb-sm items-center"},Oe={class:"col-8 text-body1"},Ge={class:"row q-mb-sm items-center"},ze={class:"col-8 text-body1"},Ke={class:"row q-mb-sm items-center"},Le={class:"col-8 text-body1"},Je={class:"row q-mb-sm items-center"},We={class:"col-8 text-body1"},Ye={key:0,class:"row q-mb-sm items-center"},He={key:1,class:"row q-mb-sm items-center"},Xe={key:2,class:"row q-mb-sm items-center"},Ze={class:"col-8 text-body1"},et={key:3,class:"row q-mb-sm items-center"},tt={class:"col-8 text-body1"},lt={class:"q-pa-md"},st={class:"row items-center q-gutter-md"},at={class:"rounded-borders overflow-hidden",style:{"background-color":"#8a82f7"}},ot={class:"column q-gutter-sm"},nt={class:"row q-gutter-md"},it={class:"text-subtitle2 q-mb-xs"},te="https://storage.googleapis.com/a1aa/image/089155c9-d1c1-4945-5728-c9bdb3576171.jpg",qt=Object.assign({layout:Ee},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(Q){const G=Q,{formatDate:z}=Te(),c=d({offices:[],type:null,scheme:null}),le=[{label:"MR",value:"MR"},{label:"PE",value:"PE"}],se=[{label:"No",value:"no"},{label:"Yes",value:"yes"}],F=d(""),v=Ue(),V=d([]),R=d(!1),C=d(!1),$=d(!1),g=d(null);function ae(){if(!c.value.offices||c.value.offices.length===0){v.notify({type:"negative",message:"Please select an office"});return}$.value=!0,V.value=[],setTimeout(()=>{g.value&&g.value.requestServerInteraction()})}function j(){w.value.page=1,g.value&&g.value.requestServerInteraction()}function I(){V.value=[],$.value=!1}function oe(s){(!s||s.length===0)&&I()}const N=d(null);function ne(){var s;(s=N.value)==null||s.click()}function ie(s){const e=s.target.files[0];if(e&&e.size<=800*1024){const l=new FileReader;l.onload=()=>{P.value=l.result},n.avatar=e,l.readAsDataURL(e)}else alert("File too large or invalid type. Max size: 800KB.")}function re(){var s;P.value=(s=G.data)!=null&&s.avatar?`/storage/${G.data.avatar}`:te,n.avatar=null,N.value.value=null}const P=d(""),n=ye({documents:[],avatar:null}),w=d({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),de=[{name:"employee",label:"Employee",align:"left",field:"employee",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],U=d(null),m=d(null),ue=s=>{m.value=s,U.value=s.id,n.documents=[],s.documents&&s.documents.length>0&&s.documents.forEach(e=>{n.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),s!=null&&s.avatar?P.value=`/storage/${s.avatar}`:P.value=te,C.value=!0},me=(s,e)=>{n.documents[s]={...n.documents[s],file:e}};function ce(s){const{page:e,rowsPerPage:l,sortBy:i,descending:h}=s.pagination;R.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...c.value},page:e,rowsPerPage:l,search:F.value,sortBy:i,descending:h}}).then(p=>{const{list:y}=p.data,{data:b,per_page:T,current_page:S,total:B}=y;V.value=b,w.value.page=S,w.value.rowsNumber=B,w.value.rowsPerPage=T}).catch(p=>{var y,b;v.notify({type:"negative",message:(b=(y=p==null?void 0:p.response)==null?void 0:y.data)==null?void 0:b.message})}).finally(()=>R.value=!1)}const pe=()=>{if(!U.value)return;const s=new FormData;Object.entries(n.documents).forEach(([e,l])=>{l!=null&&l.file&&s.append(`documents[${e}]`,l.file)}),n.avatar&&typeof n.avatar!="string"&&s.append("avatar",n.avatar),axios.post(route("document.update",U.value),s,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:l,message:i}=e;v.notify({type:"positive",message:i||"Employee saved successfully."}),g.value&&g.value.requestServerInteraction(),C.value=!1,n.documents=[],U.value=null}).catch(e=>{var l;if(e.response)if(e.response.status===422){const i=e.response.data.errors,h=i?Object.values(i)[0][0]:"Validation failed.";v.notify({type:"negative",message:h})}else v.notify({type:"negative",message:((l=e.response.data)==null?void 0:l.message)||"Something went wrong!"});else e.request?v.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):v.notify({type:"negative",message:"Unexpected error occurred."})})},fe=s=>{window.open(s,"_blank")},ve=()=>{window.history.back()};return(s,e)=>(r(),_(Ce,{class:"container",padding:""},{default:o(()=>[t("div",Se,[t("div",null,[e[8]||(e[8]=t("div",{class:"stitle"},"Employee Documents",-1)),a(ge,{class:"text-dark"},{default:o(()=>[a(Y,{onClick:e[0]||(e[0]=l=>s.$inertia.get(s.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),a(Y,{class:"cursor-pointer",label:"Go Back",onClick:ve})]),_:1})])]),e[21]||(e[21]=t("br",null,null,-1)),a(M,{flat:""},{default:o(()=>[a(D,null,{default:o(()=>[t("div",Be,[a(M,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[a(D,null,{default:o(()=>[e[9]||(e[9]=t("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),t("div",Fe,[a(A,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:c.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=l=>c.value.offices=l),oe],options:Q.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:I},null,8,["modelValue","options"]),a(A,{label:"Select Employment Type",class:"col-12 col-sm-4",modelValue:c.value.type,"onUpdate:modelValue":[e[2]||(e[2]=l=>c.value.type=l),j],options:le,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:I},null,8,["modelValue"]),c.value.type==="MR"?(r(),_(A,{key:0,label:"Is Scheme?",class:"col-12 col-sm-4",modelValue:c.value.scheme,"onUpdate:modelValue":[e[3]||(e[3]=l=>c.value.scheme=l),j],options:se,"emit-value":"","map-options":"",outlined:"",dense:"",clearable:""},null,8,["modelValue"])):f("",!0)])]),_:1,__:[9]}),a(H),a(D,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[t("div",Re,[Q.canUpdateDocument?(r(),_(x,{key:0,label:"Get Employee",color:"primary",onClick:ae})):f("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[22]||(e[22]=t("br",null,null,-1)),$.value?(r(),_(Pe,{key:0,ref_key:"empTable",ref:g,title:"Employees Document",rows:V.value,columns:de,"row-key":"id",loading:R.value,pagination:w.value,"onUpdate:pagination":e[5]||(e[5]=l=>w.value=l),"rows-per-page-options":[5,10,20,50],onRequest:ce},{"top-right":o(()=>[a(_e,{dense:"",outlined:"",debounce:"800",modelValue:F.value,"onUpdate:modelValue":[e[4]||(e[4]=l=>F.value=l),j],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[a(Z,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-employee":o(l=>[a(O,{props:l},{default:o(()=>[t("div",$e,[a(be,null,{default:o(()=>[l.row.avatar?(r(),_(ee,{key:0,src:`/storage/${l.row.avatar}`},null,8,["src"])):(r(),_(Z,{key:1,name:"person",size:"md",color:"primary"}))]),_:2},1024),t("div",null,[t("div",je,u(l.row.name),1),t("div",Ie,u(l.row.mobile),1),t("div",Ne,u(E(z)(l.row.date_of_birth)),1)])]),X(" "+u(),1)]),_:2},1032,["props"])]),"body-cell-office":o(l=>[a(O,{props:l},{default:o(()=>{var i;return[X(u((i=l.row.office)==null?void 0:i.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(l=>[a(O,{props:l},{default:o(()=>[Q.canUpdateDocument?(r(),_(x,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:i=>ue(l.row),"aria-label":"Edit"},null,8,["onClick"])):f("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):f("",!0),a(xe,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l)},{default:o(()=>[a(M,{style:{"min-width":"750px"}},{default:o(()=>[a(D,null,{default:o(()=>e[10]||(e[10]=[t("div",{class:"text-lg font-bold"},"Update Docment",-1)])),_:1,__:[10]}),a(D,{class:"q-gutter-md"},{default:o(()=>{var l,i,h,p,y,b,T,S,B,K;return[t("div",Ae,[t("div",null,[t("div",Me,[e[11]||(e[11]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),t("div",Oe,u((l=m.value)==null?void 0:l.name),1)]),t("div",Ge,[e[12]||(e[12]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Parent Name",-1)),t("div",ze,u((i=m.value)==null?void 0:i.parent_name),1)]),t("div",Ke,[e[13]||(e[13]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Date of Birth",-1)),t("div",Le,u(E(z)((h=m.value)==null?void 0:h.date_of_birth)),1)]),t("div",Je,[e[14]||(e[14]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Present Address",-1)),t("div",We,u((p=m.value)==null?void 0:p.address),1)]),((y=m.value)==null?void 0:y.employment_type)==="PE"?(r(),q("div",Ye,e[15]||(e[15]=[t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),t("div",{class:"col-8 text-body1"},"Provisional Employee",-1)]))):f("",!0),((b=m.value)==null?void 0:b.employment_type)==="MR"?(r(),q("div",He,e[16]||(e[16]=[t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1),t("div",{class:"col-8 text-body1"},"Muster Roll Employee",-1)]))):f("",!0),((T=m.value)==null?void 0:T.employment_type)==="PE"?(r(),q("div",Xe,[e[17]||(e[17]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Designation",-1)),t("div",Ze,u((S=m.value)==null?void 0:S.designation),1)])):f("",!0),((B=m.value)==null?void 0:B.employment_type)==="MR"?(r(),q("div",et,[e[18]||(e[18]=t("div",{class:"col-4 text-subtitle2 text-grey-8"},"Post/Work Assigned",-1)),t("div",tt,u((K=m.value)==null?void 0:K.post_assigned),1)])):f("",!0)]),e[20]||(e[20]=t("div",{class:"absolute top-0 bottom-0 left-1/2 w-px bg-gray-300"},null,-1)),t("div",null,[t("div",lt,[t("div",st,[t("div",at,[a(ee,{src:P.value,alt:"Profile Photo",style:{width:"120px",height:"120px"},"img-class":"object-cover"},null,8,["src"])]),t("div",ot,[t("div",nt,[a(x,{label:"Upload new Photo",color:"primary",onClick:ne,class:"text-weight-medium",rounded:"",unelevated:""}),a(x,{label:"Reset",color:"grey-4","text-color":"dark",onClick:re,class:"text-weight-medium",rounded:"",unelevated:""})]),e[19]||(e[19]=t("p",{class:"text-subtitle2 text-grey-7"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1))])]),t("input",{ref_key:"fileInput",ref:N,type:"file",accept:"image/*",class:"hidden",onChange:ie},null,544)]),(r(!0),q(we,null,he(Q.documentTypes,(k,rt)=>{var L,J;return r(),q("div",{class:"col-12 col-sm-6",key:k.id},[t("div",it,u(k.name),1),a(De,{filled:"","model-value":((L=E(n).documents[k.id])==null?void 0:L.file)||null,"onUpdate:modelValue":W=>me(k.id,W),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},ke({_:2},[(J=E(n).documents[k.id])!=null&&J.url?{name:"append",fn:o(()=>[a(x,{round:"",dense:"",flat:"",icon:"visibility",onClick:W=>fe(E(n).documents[k.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))])]),a(H)]}),_:1}),a(qe,{align:"right"},{default:o(()=>[Qe(a(x,{flat:"",label:"Cancel",onClick:e[6]||(e[6]=l=>!C.value)},null,512),[[Ve]]),a(x,{color:"primary",label:"Update",onClick:pe})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[21,22]}))}});export{qt as default};
