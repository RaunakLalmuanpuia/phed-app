import{Q as Z}from"./QChip-Cz7ggu1X.js";import{Q as H,a as S}from"./QBreadcrumbs-gxpg3Zi_.js";import{r as c,d as p,o as g,w as l,g as d,i as n,f as Q,h as f,e as J,F as K,v as M,y as x,z as q,Q as P,p as W,q as B,t as _,u as N,D as X}from"./app-aK7g-iTq.js";import{Q as b}from"./QTd-wZkOV0cn.js";import{Q as ee}from"./QTable-DeP6rFFZ.js";import{Q as ae}from"./QLayout-B7FSB2aV.js";import{_ as te}from"./BackendLayout-BfpJhe5c.js";import{u as le}from"./use-quasar-BGGe8Y7v.js";import{u as ne}from"./useUtils-Cc9Kjo92.js";import"./format-CeS7-v3W.js";import"./QMarkupTable-BDheeHPC.js";import"./QSelect-CyFP2TOq.js";import"./use-fullscreen-C0vzcUOB.js";import"./touch-CzCxgh4L.js";import"./QSlideTransition-C1GIIeGg.js";import"./date-Kx95Jvws.js";const oe={class:"flex items-center justify-between q-pa-md bg-white"},re={class:"stitle"},se={class:"q-pa-md"},de={class:"row q-col-gutter-md"},ie={class:"row q-gutter-sm col-12 col-sm justify-end"},Qe=Object.assign({layout:te},{__name:"EngagementCard",props:["offices","canDownloadEngagementCard"],setup(k){const{formatDate:V}=ne(),T=k,s=c({startYear:"",endYear:""}),C=c(""),U=c([]),i=le(),v=c([]),h=c(!1),Y=c(!1),u=c(null);function I(){if(!s.value.startYear){i.notify({type:"negative",message:"Please select the Start Year"});return}if(!s.value.endYear){i.notify({type:"negative",message:"Please select the End Year"});return}Y.value=!0,v.value=[],setTimeout(()=>{u.value&&u.value.requestServerInteraction()})}function $(){m.value.page=1,u.value&&u.value.requestServerInteraction()}function D(){v.value=[],Y.value=!1}const m=c({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),j=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left"},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"card_no",label:"Card No.",field:"engagement_card.card_no",align:"center"},{name:"start_date",label:"Start Date",field:"engagement_card.start_date",align:"center"},{name:"end_date",label:"End Date",field:"engagement_card.end_date",align:"center"},{name:"actions",label:"Actions",align:"center"}];function R(r){const{page:a,rowsPerPage:e,sortBy:t,descending:E}=r.pagination;h.value=!0,axios.get(route("mis.manager-json-engagement-card"),{params:{filter:{...s.value},page:a,rowsPerPage:e,search:C.value,sortBy:t,descending:E}}).then(o=>{const{list:w}=o.data,{data:y,per_page:O,current_page:z,total:A}=w;v.value=y,m.value.page=z,m.value.rowsNumber=A,m.value.rowsPerPage=O}).catch(o=>{var w,y;i.notify({type:"negative",message:(y=(w=o==null?void 0:o.response)==null?void 0:w.data)==null?void 0:y.message})}).finally(()=>h.value=!1)}const G=async r=>{try{const a=await axios.get(route("engagement-card.download",r),{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([a.data],{type:"application/pdf"})),t=document.createElement("a");t.href=e,t.setAttribute("download",`EngagementCard_${r.card_no}.pdf`),document.body.appendChild(t),t.click(),t.remove()}catch(a){i.notify({type:"negative",message:a})}},L=async()=>{var r,a;try{const e=(r=T.offices[0])==null?void 0:r.value;i.loading.show({message:"Generating ZIP file... Please wait."});const t=await axios.post(route("engagement-card.bulk-download"),{office_id:e,start_date:`${s.value.startYear}-03-01`,end_date:`${s.value.endYear}-02-28`},{responseType:"blob"}),E=window.URL.createObjectURL(new Blob([t.data],{type:"application/zip"})),o=document.createElement("a");o.href=E,o.setAttribute("download",`EngagementCards_${Date.now()}.zip`),document.body.appendChild(o),o.click(),o.remove(),(a=u.value)==null||a.requestServerInteraction(),U.value=[],i.notify({type:"positive",message:"ZIP downloaded successfully."})}catch(e){i.notify({type:"negative",message:"No Engagement card to Download"}),console.error(e)}finally{i.loading.hide()}},F=()=>{window.history.back()};return(r,a)=>(g(),p(ae,{class:"container",padding:""},{default:l(()=>[d("div",oe,[d("div",null,[d("div",re,[a[5]||(a[5]=f("Engagement Card :")),(g(!0),J(K,null,M(k.offices,e=>(g(),p(Z,{square:"",key:e.value,label:e.label},null,8,["label"]))),128))]),n(H,{class:"text-dark"},{default:l(()=>[n(S,{onClick:a[0]||(a[0]=e=>r.$inertia.get(r.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),n(S,{class:"cursor-pointer",label:"Go Back",onClick:F})]),_:1})])]),a[7]||(a[7]=d("br",null,null,-1)),n(x,{flat:""},{default:l(()=>[n(q,null,{default:l(()=>[d("div",se,[n(x,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:l(()=>[n(q,null,{default:l(()=>[a[6]||(a[6]=d("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Fiscal Year Filter ",-1)),d("div",de,[n(P,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"Start Year",modelValue:s.value.startYear,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.startYear=e),mask:"####",placeholder:"YYYY",onClear:D},null,8,["modelValue"]),n(P,{class:"col-12 col-sm-4",outlined:"",dense:"",clearable:"",label:"End Year",modelValue:s.value.endYear,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.endYear=e),mask:"####",placeholder:"YYYY",onClear:D},null,8,["modelValue"])])]),_:1,__:[6]}),n(W),n(q,{class:"row items-center justify-between q-gutter-md"},{default:l(()=>[d("div",ie,[k.canDownloadEngagementCard?(g(),p(B,{key:0,label:"Get Employee",color:"primary",onClick:I})):Q("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),a[8]||(a[8]=d("br",null,null,-1)),Y.value?(g(),p(ee,{key:0,ref_key:"empTable",ref:u,title:"Employees Engagement Cards",rows:v.value,columns:j,"row-key":"id",loading:h.value,pagination:m.value,"onUpdate:pagination":a[4]||(a[4]=e=>m.value=e),"rows-per-page-options":[5,10,20,50],onRequest:R},{"top-right":l(()=>[n(B,{class:"q-mr-sm",icon:"download",label:"Download ZIP",color:"primary",onClick:L}),n(P,{dense:"",outlined:"",debounce:"800",modelValue:C.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>C.value=e),$],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:l(()=>[n(X,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":l(e=>[n(b,{props:e},{default:l(()=>{var t;return[f(_((t=e.row.office)==null?void 0:t.name),1)]}),_:2},1032,["props"])]),"body-cell-card_no":l(e=>[n(b,{props:e},{default:l(()=>{var t;return[f(_(((t=e.row.engagement_card[0])==null?void 0:t.card_no)??"Not Generated"),1)]}),_:2},1032,["props"])]),"body-cell-start_date":l(e=>[n(b,{props:e},{default:l(()=>{var t;return[f(_(N(V)((t=e.row.engagement_card[0])==null?void 0:t.start_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-end_date":l(e=>[n(b,{props:e},{default:l(()=>{var t;return[f(_(N(V)((t=e.row.engagement_card[0])==null?void 0:t.end_date)??"-"),1)]}),_:2},1032,["props"])]),"body-cell-actions":l(e=>[n(b,{props:e},{default:l(()=>[e.row.engagement_card[0]?(g(),p(B,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"download",onClick:t=>G(e.row.engagement_card[0]),"aria-label":"Generate Card"},null,8,["onClick"])):Q("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):Q("",!0)]),_:1,__:[7,8]}))}});export{Qe as default};
