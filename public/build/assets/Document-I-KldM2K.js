import{Q as X,a as j}from"./QBreadcrumbs-CbAYRsRA.js";import{Q as Y}from"./QSelect-C89wUzsO.js";import{r as u,x as Z,d as q,o as v,w as o,e as s,i as a,g as T,y as S,z as w,p as N,q as _,h as ee,t as C,Q as te,D as ae,a0 as le,f as $,F as oe,v as se,u as B,G as ne,$ as ie,N as ue}from"./app-Csdj5SGi.js";import{Q as F}from"./QTd-C5hlBMgh.js";import{Q as re}from"./QTable-C7KcX2jc.js";import{Q as de}from"./QFile-Dr1dOsUs.js";import{Q as me}from"./QLayout-BPWLh4lA.js";import{_ as ce,C as fe}from"./BackendLayout-BGbchfdi.js";import{u as pe}from"./use-quasar-DnnNbvl1.js";import"./QMarkupTable-B5IkZCXF.js";import"./use-fullscreen-9-Fr_W2X.js";import"./touch-BJJBQK6Q.js";import"./QSlideTransition-DSWNnvz6.js";const ge={class:"flex items-center justify-between q-pa-md bg-white"},ve={class:"q-pa-md"},ye={class:"row q-col-gutter-md"},be={class:"row q-gutter-sm col-12 col-sm justify-end"},we={class:"row q-mb-sm items-center"},_e={class:"col-8 text-body1"},ke={class:"row q-mb-sm items-center"},he={class:"col-8 text-body1"},Qe={class:"text-subtitle2 q-mb-xs"},$e=Object.assign({layout:ce},{__name:"Document",props:["office","documentTypes","canUpdateDocument"],setup(k){const y=u({offices:[]}),D=u(""),d=pe(),h=u([]),V=u(!1),b=u(!1),U=u(!1),m=u(null);function O(){if(!y.value.offices||y.value.offices.length===0){d.notify({type:"negative",message:"Please select an office"});return}U.value=!0,h.value=[],setTimeout(()=>{m.value&&m.value.requestServerInteraction()})}function I(){p.value.page=1,m.value&&m.value.requestServerInteraction()}function P(){h.value=[],U.value=!1}function R(l){(!l||l.length===0)&&P()}const r=Z({documents:[]}),p=u({sortBy:"name",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),A=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"employment_type",label:"Employment Type",field:"employment_type",align:"left",sortable:!0},{name:"designation",label:"Designation",field:"designation",align:"left",sortable:!0},{name:"post_assigned",label:"Post Assigned",field:"post_assigned",align:"left",sortable:!0},{name:"office",label:"Office",field:"office.name",align:"left"},{name:"actions",label:"Actions",align:"center"}],Q=u(null),E=u(null),G=l=>{E.value=l,Q.value=l.id,r.documents=[],l.documents&&l.documents.length>0&&l.documents.forEach(e=>{r.documents[e.document_type_id]={url:`/storage/${e.path}`,name:e.name,type:e.type,file:null}}),b.value=!0},z=(l,e)=>{r.documents[l]={...r.documents[l],file:e}};function L(l){const{page:e,rowsPerPage:t,sortBy:n,descending:i}=l.pagination;V.value=!0,axios.get(route("mis.json-employee-document"),{params:{filter:{...y.value},page:e,rowsPerPage:t,search:D.value,sortBy:n,descending:i}}).then(g=>{const{list:c}=g.data,{data:f,per_page:x,current_page:M,total:W}=c;h.value=f,p.value.page=M,p.value.rowsNumber=W,p.value.rowsPerPage=x}).catch(g=>{var c,f;d.notify({type:"negative",message:(f=(c=g==null?void 0:g.response)==null?void 0:c.data)==null?void 0:f.message})}).finally(()=>V.value=!1)}const H=()=>{if(!Q.value)return;const l=new FormData;Object.entries(r.documents).forEach(([e,t])=>{t!=null&&t.file&&l.append(`documents[${e}]`,t.file)}),axios.post(route("document.update",Q.value),l,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:e})=>{const{employee:t,message:n}=e;d.notify({type:"positive",message:n||"Employee saved successfully."}),m.value&&m.value.requestServerInteraction(),b.value=!1,r.documents=[],Q.value=null}).catch(e=>{var t;if(e.response)if(e.response.status===422){const n=e.response.data.errors,i=n?Object.values(n)[0][0]:"Validation failed.";d.notify({type:"negative",message:i})}else d.notify({type:"negative",message:((t=e.response.data)==null?void 0:t.message)||"Something went wrong!"});else e.request?d.notify({type:"negative",message:"Upload failed: File too large or server did not respond."}):d.notify({type:"negative",message:"Unexpected error occurred."})})},J=l=>{window.open(l,"_blank")},K=()=>{window.history.back()};return(l,e)=>(v(),q(me,{class:"container",padding:""},{default:o(()=>[s("div",ge,[s("div",null,[e[6]||(e[6]=s("div",{class:"stitle"},"Employee Documents",-1)),a(X,{class:"text-dark"},{default:o(()=>[a(j,{onClick:e[0]||(e[0]=t=>l.$inertia.get(l.route("dashboard"))),icon:"dashboard",label:"Dashboard",class:"cursor-pointer"}),a(j,{class:"cursor-pointer",label:"Go Back",onClick:K})]),_:1})])]),e[11]||(e[11]=s("br",null,null,-1)),a(S,{flat:""},{default:o(()=>[a(w,null,{default:o(()=>[s("div",ve,[a(S,{flat:"",class:"q-mt-md bg-white shadow-1"},{default:o(()=>[a(w,null,{default:o(()=>[e[7]||(e[7]=s("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-md"}," Office Filter ",-1)),s("div",ye,[a(Y,{label:"Select Office(s)",class:"col-12 col-sm-4",modelValue:y.value.offices,"onUpdate:modelValue":[e[1]||(e[1]=t=>y.value.offices=t),R],options:k.office,"option-label":"name","option-value":"id","emit-value":"","map-options":"",outlined:"",dense:"",clearable:"",onClear:P},null,8,["modelValue","options"])])]),_:1,__:[7]}),a(N),a(w,{class:"row items-center justify-between q-gutter-md"},{default:o(()=>[s("div",be,[k.canUpdateDocument?(v(),q(_,{key:0,label:"Get Employee",color:"primary",onClick:O})):T("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1}),e[12]||(e[12]=s("br",null,null,-1)),U.value?(v(),q(re,{key:0,ref_key:"empTable",ref:m,title:"Employees Document",rows:h.value,columns:A,"row-key":"id",loading:V.value,pagination:p.value,"onUpdate:pagination":e[3]||(e[3]=t=>p.value=t),"rows-per-page-options":[5,10,20,50],onRequest:L},{"top-right":o(()=>[a(te,{dense:"",outlined:"",debounce:"800",modelValue:D.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>D.value=t),I],placeholder:"Search",class:"col-12 col-sm-auto",clearable:""},{append:o(()=>[a(ae,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-office":o(t=>[a(F,{props:t},{default:o(()=>{var n;return[ee(C((n=t.row.office)==null?void 0:n.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":o(t=>[a(F,{props:t},{default:o(()=>[k.canUpdateDocument?(v(),q(_,{key:0,dense:"",flat:"",round:"",color:"primary",icon:"edit",onClick:n=>G(t.row),"aria-label":"Edit"},null,8,["onClick"])):T("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])):T("",!0),a(le,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t)},{default:o(()=>[a(S,{style:{"min-width":"400px"}},{default:o(()=>[a(w,null,{default:o(()=>e[8]||(e[8]=[s("div",{class:"text-h6"},"Update Document",-1)])),_:1,__:[8]}),a(w,{class:"q-gutter-md"},{default:o(()=>{var t,n;return[s("div",we,[e[9]||(e[9]=s("div",{class:"col-4 text-subtitle2 text-grey-8"},"Name",-1)),s("div",_e,C((t=E.value)==null?void 0:t.name),1)]),s("div",ke,[e[10]||(e[10]=s("div",{class:"col-4 text-subtitle2 text-grey-8"},"Employment Type",-1)),s("div",he,C((n=E.value)==null?void 0:n.employment_type),1)]),a(N),(v(!0),$(oe,null,se(k.documentTypes,(i,g)=>{var c,f;return v(),$("div",{class:"col-12 col-sm-6",key:i.id},[s("div",Qe,C(i.name),1),a(de,{filled:"","model-value":((c=B(r).documents[i.id])==null?void 0:c.file)||null,"onUpdate:modelValue":x=>z(i.id,x),label:"Upload File",accept:".pdf,.jpg,.jpeg,.png",clearable:"",class:"full-width"},ne({_:2},[(f=B(r).documents[i.id])!=null&&f.url?{name:"append",fn:o(()=>[a(_,{round:"",dense:"",flat:"",icon:"visibility",onClick:x=>J(B(r).documents[i.id].url),class:"q-ml-sm"},null,8,["onClick"])]),key:"0"}:void 0]),1032,["model-value","onUpdate:modelValue"])])}),128))]}),_:1}),a(ie,{align:"right"},{default:o(()=>[ue(a(_,{flat:"",label:"Cancel",onClick:e[4]||(e[4]=t=>!b.value)},null,512),[[fe]]),a(_,{color:"primary",label:"Update",onClick:H})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[11,12]}))}});export{$e as default};
